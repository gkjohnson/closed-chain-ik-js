import{y as Dt,V as l,z as W,E as q,Q as A,H as _t,h as L,t as zt,m as Ct,x as Ht,R as Qt,O as dt,k as vt,K as Nt,N as x,U as E,u as ft,X as yt,M as h,Y as it,Z as X,_ as F,j as Ut,$ as qt,o as At,v as Wt,q as Ft}from"./IKRootsHelper-COUPCDCE.js";const wt={type:"change"},ut={type:"start"},It={type:"end"},st=new zt,bt=new Ct,Gt=Math.cos(70*Ht.DEG2RAD),y=new l,T=2*Math.PI,p={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},lt=1e-6;class fe extends Dt{constructor(t,e=null){super(t,e),this.state=p.NONE,this.target=new l,this.cursor=new l,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:W.ROTATE,MIDDLE:W.DOLLY,RIGHT:W.PAN},this.touches={ONE:q.ROTATE,TWO:q.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new l,this._lastQuaternion=new A,this._lastTargetPosition=new l,this._quat=new A().setFromUnitVectors(t.up,new l(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new _t,this._sphericalDelta=new _t,this._scale=1,this._panOffset=new l,this._rotateStart=new L,this._rotateEnd=new L,this._rotateDelta=new L,this._panStart=new L,this._panEnd=new L,this._panDelta=new L,this._dollyStart=new L,this._dollyEnd=new L,this._dollyDelta=new L,this._dollyDirection=new l,this._mouse=new L,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=Bt.bind(this),this._onPointerDown=Kt.bind(this),this._onPointerUp=Vt.bind(this),this._onContextMenu=oe.bind(this),this._onMouseWheel=te.bind(this),this._onKeyDown=ee.bind(this),this._onTouchStart=ie.bind(this),this._onTouchMove=se.bind(this),this._onMouseDown=$t.bind(this),this._onMouseMove=Jt.bind(this),this._interceptControlDown=ne.bind(this),this._interceptControlUp=ae.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(t){super.connect(t),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(t){t.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=t}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(wt),this.update(),this.state=p.NONE}update(t=null){const e=this.object.position;y.copy(e).sub(this.target),y.applyQuaternion(this._quat),this._spherical.setFromVector3(y),this.autoRotate&&this.state===p.NONE&&this._rotateLeft(this._getAutoRotationAngle(t)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let o=this.minAzimuthAngle,s=this.maxAzimuthAngle;isFinite(o)&&isFinite(s)&&(o<-Math.PI?o+=T:o>Math.PI&&(o-=T),s<-Math.PI?s+=T:s>Math.PI&&(s-=T),o<=s?this._spherical.theta=Math.max(o,Math.min(s,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(o+s)/2?Math.max(o,this._spherical.theta):Math.min(s,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let a=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const i=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),a=i!=this._spherical.radius}if(y.setFromSpherical(this._spherical),y.applyQuaternion(this._quatInverse),e.copy(this.target).add(y),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let i=null;if(this.object.isPerspectiveCamera){const r=y.length();i=this._clampDistance(r*this._scale);const _=r-i;this.object.position.addScaledVector(this._dollyDirection,_),this.object.updateMatrixWorld(),a=!!_}else if(this.object.isOrthographicCamera){const r=new l(this._mouse.x,this._mouse.y,0);r.unproject(this.object);const _=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),a=_!==this.object.zoom;const w=new l(this._mouse.x,this._mouse.y,0);w.unproject(this.object),this.object.position.sub(w).add(r),this.object.updateMatrixWorld(),i=y.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;i!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(i).add(this.object.position):(st.origin.copy(this.object.position),st.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(st.direction))<Gt?this.object.lookAt(this.target):(bt.setFromNormalAndCoplanarPoint(this.object.up,this.target),st.intersectPlane(bt,this.target))))}else if(this.object.isOrthographicCamera){const i=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),i!==this.object.zoom&&(this.object.updateProjectionMatrix(),a=!0)}return this._scale=1,this._performCursorZoom=!1,a||this._lastPosition.distanceToSquared(this.object.position)>lt||8*(1-this._lastQuaternion.dot(this.object.quaternion))>lt||this._lastTargetPosition.distanceToSquared(this.target)>lt?(this.dispatchEvent(wt),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(t){return t!==null?T/60*this.autoRotateSpeed*t:T/60/60*this.autoRotateSpeed}_getZoomScale(t){const e=Math.abs(t*.01);return Math.pow(.95,this.zoomSpeed*e)}_rotateLeft(t){this._sphericalDelta.theta-=t}_rotateUp(t){this._sphericalDelta.phi-=t}_panLeft(t,e){y.setFromMatrixColumn(e,0),y.multiplyScalar(-t),this._panOffset.add(y)}_panUp(t,e){this.screenSpacePanning===!0?y.setFromMatrixColumn(e,1):(y.setFromMatrixColumn(e,0),y.crossVectors(this.object.up,y)),y.multiplyScalar(t),this._panOffset.add(y)}_pan(t,e){const o=this.domElement;if(this.object.isPerspectiveCamera){const s=this.object.position;y.copy(s).sub(this.target);let a=y.length();a*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*t*a/o.clientHeight,this.object.matrix),this._panUp(2*e*a/o.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(t*(this.object.right-this.object.left)/this.object.zoom/o.clientWidth,this.object.matrix),this._panUp(e*(this.object.top-this.object.bottom)/this.object.zoom/o.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(t,e){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const o=this.domElement.getBoundingClientRect(),s=t-o.left,a=e-o.top,i=o.width,r=o.height;this._mouse.x=s/i*2-1,this._mouse.y=-(a/r)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(t){return Math.max(this.minDistance,Math.min(this.maxDistance,t))}_handleMouseDownRotate(t){this._rotateStart.set(t.clientX,t.clientY)}_handleMouseDownDolly(t){this._updateZoomParameters(t.clientX,t.clientX),this._dollyStart.set(t.clientX,t.clientY)}_handleMouseDownPan(t){this._panStart.set(t.clientX,t.clientY)}_handleMouseMoveRotate(t){this._rotateEnd.set(t.clientX,t.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const e=this.domElement;this._rotateLeft(T*this._rotateDelta.x/e.clientHeight),this._rotateUp(T*this._rotateDelta.y/e.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(t){this._dollyEnd.set(t.clientX,t.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(t){this._panEnd.set(t.clientX,t.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(t){this._updateZoomParameters(t.clientX,t.clientY),t.deltaY<0?this._dollyIn(this._getZoomScale(t.deltaY)):t.deltaY>0&&this._dollyOut(this._getZoomScale(t.deltaY)),this.update()}_handleKeyDown(t){let e=!1;switch(t.code){case this.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateUp(T*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),e=!0;break;case this.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateUp(-T*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),e=!0;break;case this.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateLeft(T*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),e=!0;break;case this.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateLeft(-T*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),e=!0;break}e&&(t.preventDefault(),this.update())}_handleTouchStartRotate(t){if(this._pointers.length===1)this._rotateStart.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),o=.5*(t.pageX+e.x),s=.5*(t.pageY+e.y);this._rotateStart.set(o,s)}}_handleTouchStartPan(t){if(this._pointers.length===1)this._panStart.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),o=.5*(t.pageX+e.x),s=.5*(t.pageY+e.y);this._panStart.set(o,s)}}_handleTouchStartDolly(t){const e=this._getSecondPointerPosition(t),o=t.pageX-e.x,s=t.pageY-e.y,a=Math.sqrt(o*o+s*s);this._dollyStart.set(0,a)}_handleTouchStartDollyPan(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enablePan&&this._handleTouchStartPan(t)}_handleTouchStartDollyRotate(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enableRotate&&this._handleTouchStartRotate(t)}_handleTouchMoveRotate(t){if(this._pointers.length==1)this._rotateEnd.set(t.pageX,t.pageY);else{const o=this._getSecondPointerPosition(t),s=.5*(t.pageX+o.x),a=.5*(t.pageY+o.y);this._rotateEnd.set(s,a)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const e=this.domElement;this._rotateLeft(T*this._rotateDelta.x/e.clientHeight),this._rotateUp(T*this._rotateDelta.y/e.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(t){if(this._pointers.length===1)this._panEnd.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),o=.5*(t.pageX+e.x),s=.5*(t.pageY+e.y);this._panEnd.set(o,s)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(t){const e=this._getSecondPointerPosition(t),o=t.pageX-e.x,s=t.pageY-e.y,a=Math.sqrt(o*o+s*s);this._dollyEnd.set(0,a),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const i=(t.pageX+e.x)*.5,r=(t.pageY+e.y)*.5;this._updateZoomParameters(i,r)}_handleTouchMoveDollyPan(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enablePan&&this._handleTouchMovePan(t)}_handleTouchMoveDollyRotate(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enableRotate&&this._handleTouchMoveRotate(t)}_addPointer(t){this._pointers.push(t.pointerId)}_removePointer(t){delete this._pointerPositions[t.pointerId];for(let e=0;e<this._pointers.length;e++)if(this._pointers[e]==t.pointerId){this._pointers.splice(e,1);return}}_isTrackingPointer(t){for(let e=0;e<this._pointers.length;e++)if(this._pointers[e]==t.pointerId)return!0;return!1}_trackPointer(t){let e=this._pointerPositions[t.pointerId];e===void 0&&(e=new L,this._pointerPositions[t.pointerId]=e),e.set(t.pageX,t.pageY)}_getSecondPointerPosition(t){const e=t.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[e]}_customWheelEvent(t){const e=t.deltaMode,o={clientX:t.clientX,clientY:t.clientY,deltaY:t.deltaY};switch(e){case 1:o.deltaY*=16;break;case 2:o.deltaY*=100;break}return t.ctrlKey&&!this._controlActive&&(o.deltaY*=10),o}}function Kt(n){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(n)&&(this._addPointer(n),n.pointerType==="touch"?this._onTouchStart(n):this._onMouseDown(n)))}function Bt(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchMove(n):this._onMouseMove(n))}function Vt(n){switch(this._removePointer(n),this._pointers.length){case 0:this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(It),this.state=p.NONE;break;case 1:const t=this._pointers[0],e=this._pointerPositions[t];this._onTouchStart({pointerId:t,pageX:e.x,pageY:e.y});break}}function $t(n){let t;switch(n.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=-1}switch(t){case W.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(n),this.state=p.DOLLY;break;case W.ROTATE:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=p.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=p.ROTATE}break;case W.PAN:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=p.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=p.PAN}break;default:this.state=p.NONE}this.state!==p.NONE&&this.dispatchEvent(ut)}function Jt(n){switch(this.state){case p.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(n);break;case p.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(n);break;case p.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(n);break}}function te(n){this.enabled===!1||this.enableZoom===!1||this.state!==p.NONE||(n.preventDefault(),this.dispatchEvent(ut),this._handleMouseWheel(this._customWheelEvent(n)),this.dispatchEvent(It))}function ee(n){this.enabled!==!1&&this._handleKeyDown(n)}function ie(n){switch(this._trackPointer(n),this._pointers.length){case 1:switch(this.touches.ONE){case q.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(n),this.state=p.TOUCH_ROTATE;break;case q.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(n),this.state=p.TOUCH_PAN;break;default:this.state=p.NONE}break;case 2:switch(this.touches.TWO){case q.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(n),this.state=p.TOUCH_DOLLY_PAN;break;case q.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(n),this.state=p.TOUCH_DOLLY_ROTATE;break;default:this.state=p.NONE}break;default:this.state=p.NONE}this.state!==p.NONE&&this.dispatchEvent(ut)}function se(n){switch(this._trackPointer(n),this.state){case p.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(n),this.update();break;case p.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(n),this.update();break;case p.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(n),this.update();break;case p.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(n),this.update();break;default:this.state=p.NONE}}function oe(n){this.enabled!==!1&&n.preventDefault()}function ne(n){n.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function ae(n){n.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const H=new Qt,P=new l,Z=new l,m=new A,Pt={X:new l(1,0,0),Y:new l(0,1,0),Z:new l(0,0,1)},ct={type:"change"},gt={type:"mouseDown",mode:null},Et={type:"mouseUp",mode:null},St={type:"objectChange"};class ye extends Dt{constructor(t,e=null){super(void 0,e);const o=new de(this);this._root=o;const s=new ue;this._gizmo=s,o.add(s);const a=new me;this._plane=a,o.add(a);const i=this;function r(D,z){let N=z;Object.defineProperty(i,D,{get:function(){return N!==void 0?N:z},set:function(C){N!==C&&(N=C,a[D]=C,s[D]=C,i.dispatchEvent({type:D+"-changed",value:C}),i.dispatchEvent(ct))}}),i[D]=z,a[D]=z,s[D]=z}r("camera",t),r("object",void 0),r("enabled",!0),r("axis",null),r("mode","translate"),r("translationSnap",null),r("rotationSnap",null),r("scaleSnap",null),r("space","world"),r("size",1),r("dragging",!1),r("showX",!0),r("showY",!0),r("showZ",!0),r("minX",-1/0),r("maxX",1/0),r("minY",-1/0),r("maxY",1/0),r("minZ",-1/0),r("maxZ",1/0);const _=new l,w=new l,u=new A,f=new A,S=new l,I=new A,R=new l,b=new l,c=new l,g=0,O=new l;r("worldPosition",_),r("worldPositionStart",w),r("worldQuaternion",u),r("worldQuaternionStart",f),r("cameraPosition",S),r("cameraQuaternion",I),r("pointStart",R),r("pointEnd",b),r("rotationAxis",c),r("rotationAngle",g),r("eye",O),this._offset=new l,this._startNorm=new l,this._endNorm=new l,this._cameraScale=new l,this._parentPosition=new l,this._parentQuaternion=new A,this._parentQuaternionInv=new A,this._parentScale=new l,this._worldScaleStart=new l,this._worldQuaternionInv=new A,this._worldScale=new l,this._positionStart=new l,this._quaternionStart=new A,this._scaleStart=new l,this._getPointer=re.bind(this),this._onPointerDown=le.bind(this),this._onPointerHover=he.bind(this),this._onPointerMove=ce.bind(this),this._onPointerUp=pe.bind(this),e!==null&&this.connect(e)}connect(t){super.connect(t),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="auto"}getHelper(){return this._root}pointerHover(t){if(this.object===void 0||this.dragging===!0)return;t!==null&&H.setFromCamera(t,this.camera);const e=pt(this._gizmo.picker[this.mode],H);e?this.axis=e.object.name:this.axis=null}pointerDown(t){if(!(this.object===void 0||this.dragging===!0||t!=null&&t.button!==0)&&this.axis!==null){t!==null&&H.setFromCamera(t,this.camera);const e=pt(this._plane,H,!0);e&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(e.point).sub(this.worldPositionStart)),this.dragging=!0,gt.mode=this.mode,this.dispatchEvent(gt)}}pointerMove(t){const e=this.axis,o=this.mode,s=this.object;let a=this.space;if(o==="scale"?a="local":(e==="E"||e==="XYZE"||e==="XYZ")&&(a="world"),s===void 0||e===null||this.dragging===!1||t!==null&&t.button!==-1)return;t!==null&&H.setFromCamera(t,this.camera);const i=pt(this._plane,H,!0);if(i){if(this.pointEnd.copy(i.point).sub(this.worldPositionStart),o==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),a==="local"&&e!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),e.indexOf("X")===-1&&(this._offset.x=0),e.indexOf("Y")===-1&&(this._offset.y=0),e.indexOf("Z")===-1&&(this._offset.z=0),a==="local"&&e!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),s.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(a==="local"&&(s.position.applyQuaternion(m.copy(this._quaternionStart).invert()),e.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.position.applyQuaternion(this._quaternionStart)),a==="world"&&(s.parent&&s.position.add(P.setFromMatrixPosition(s.parent.matrixWorld)),e.search("X")!==-1&&(s.position.x=Math.round(s.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(s.position.y=Math.round(s.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(s.position.z=Math.round(s.position.z/this.translationSnap)*this.translationSnap),s.parent&&s.position.sub(P.setFromMatrixPosition(s.parent.matrixWorld)))),s.position.x=Math.max(this.minX,Math.min(this.maxX,s.position.x)),s.position.y=Math.max(this.minY,Math.min(this.maxY,s.position.y)),s.position.z=Math.max(this.minZ,Math.min(this.maxZ,s.position.z));else if(o==="scale"){if(e.search("XYZ")!==-1){let r=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(r*=-1),Z.set(r,r,r)}else P.copy(this.pointStart),Z.copy(this.pointEnd),P.applyQuaternion(this._worldQuaternionInv),Z.applyQuaternion(this._worldQuaternionInv),Z.divide(P),e.search("X")===-1&&(Z.x=1),e.search("Y")===-1&&(Z.y=1),e.search("Z")===-1&&(Z.z=1);s.scale.copy(this._scaleStart).multiply(Z),this.scaleSnap&&(e.search("X")!==-1&&(s.scale.x=Math.round(s.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Y")!==-1&&(s.scale.y=Math.round(s.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Z")!==-1&&(s.scale.z=Math.round(s.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(o==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const r=20/this.worldPosition.distanceTo(P.setFromMatrixPosition(this.camera.matrixWorld));let _=!1;e==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(P.copy(this.rotationAxis).cross(this.eye))*r):(e==="X"||e==="Y"||e==="Z")&&(this.rotationAxis.copy(Pt[e]),P.copy(Pt[e]),a==="local"&&P.applyQuaternion(this.worldQuaternion),P.cross(this.eye),P.length()===0?_=!0:this.rotationAngle=this._offset.dot(P.normalize())*r),(e==="E"||_)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),a==="local"&&e!=="E"&&e!=="XYZE"?(s.quaternion.copy(this._quaternionStart),s.quaternion.multiply(m.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),s.quaternion.copy(m.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),s.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(ct),this.dispatchEvent(St)}}pointerUp(t){t!==null&&t.button!==0||(this.dragging&&this.axis!==null&&(Et.mode=this.mode,this.dispatchEvent(Et)),this.dragging=!1,this.axis=null)}dispose(){this.disconnect(),this._root.dispose()}attach(t){return this.object=t,this._root.visible=!0,this}detach(){return this.object=void 0,this.axis=null,this._root.visible=!1,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(ct),this.dispatchEvent(St),this.pointStart.copy(this.pointEnd))}getRaycaster(){return H}getMode(){return this.mode}setMode(t){this.mode=t}setTranslationSnap(t){this.translationSnap=t}setRotationSnap(t){this.rotationSnap=t}setScaleSnap(t){this.scaleSnap=t}setSize(t){this.size=t}setSpace(t){this.space=t}setColors(t,e,o,s){const a=this._gizmo.materialLib;a.xAxis.color.set(t),a.yAxis.color.set(e),a.zAxis.color.set(o),a.active.color.set(s),a.xAxisTransparent.color.set(t),a.yAxisTransparent.color.set(e),a.zAxisTransparent.color.set(o),a.activeTransparent.color.set(s),a.xAxis._color&&a.xAxis._color.set(t),a.yAxis._color&&a.yAxis._color.set(e),a.zAxis._color&&a.zAxis._color.set(o),a.active._color&&a.active._color.set(s),a.xAxisTransparent._color&&a.xAxisTransparent._color.set(t),a.yAxisTransparent._color&&a.yAxisTransparent._color.set(e),a.zAxisTransparent._color&&a.zAxisTransparent._color.set(o),a.activeTransparent._color&&a.activeTransparent._color.set(s)}}function re(n){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:n.button};{const t=this.domElement.getBoundingClientRect();return{x:(n.clientX-t.left)/t.width*2-1,y:-(n.clientY-t.top)/t.height*2+1,button:n.button}}}function he(n){if(this.enabled)switch(n.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(n));break}}function le(n){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(n)),this.pointerDown(this._getPointer(n)))}function ce(n){this.enabled&&this.pointerMove(this._getPointer(n))}function pe(n){this.enabled&&(this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(n)))}function pt(n,t,e){const o=t.intersectObject(n,!0);for(let s=0;s<o.length;s++)if(o[s].object.visible||e)return o[s];return!1}const ot=new qt,d=new l(0,1,0),Mt=new l(0,0,0),xt=new At,nt=new A,rt=new A,j=new l,Tt=new At,B=new l(1,0,0),Q=new l(0,1,0),V=new l(0,0,1),at=new l,G=new l,K=new l;class de extends dt{constructor(t){super(),this.isTransformControlsRoot=!0,this.controls=t,this.visible=!1}updateMatrixWorld(t){const e=this.controls;e.object!==void 0&&(e.object.updateMatrixWorld(),e.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):e.object.parent.matrixWorld.decompose(e._parentPosition,e._parentQuaternion,e._parentScale),e.object.matrixWorld.decompose(e.worldPosition,e.worldQuaternion,e._worldScale),e._parentQuaternionInv.copy(e._parentQuaternion).invert(),e._worldQuaternionInv.copy(e.worldQuaternion).invert()),e.camera.updateMatrixWorld(),e.camera.matrixWorld.decompose(e.cameraPosition,e.cameraQuaternion,e._cameraScale),e.camera.isOrthographicCamera?e.camera.getWorldDirection(e.eye).negate():e.eye.copy(e.cameraPosition).sub(e.worldPosition).normalize(),super.updateMatrixWorld(t)}dispose(){this.traverse(function(t){t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose()})}}class ue extends dt{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const t=new vt({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),e=new Nt({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),o=t.clone();o.opacity=.15;const s=e.clone();s.opacity=.5;const a=t.clone();a.color.setHex(16711680);const i=t.clone();i.color.setHex(65280);const r=t.clone();r.color.setHex(255);const _=t.clone();_.color.setHex(16711680),_.opacity=.5;const w=t.clone();w.color.setHex(65280),w.opacity=.5;const u=t.clone();u.color.setHex(255),u.opacity=.5;const f=t.clone();f.opacity=.25;const S=t.clone();S.color.setHex(16776960),S.opacity=.25;const I=t.clone();I.color.setHex(16776960);const R=t.clone();R.color.setHex(7895160),this.materialLib={xAxis:a,yAxis:i,zAxis:r,active:I,xAxisTransparent:_,yAxisTransparent:w,zAxisTransparent:u,activeTransparent:S};const b=new x(0,.04,.1,12);b.translate(0,.05,0);const c=new E(.08,.08,.08);c.translate(0,.04,0);const g=new ft;g.setAttribute("position",new yt([0,0,0,1,0,0],3));const O=new x(.0075,.0075,.5,3);O.translate(0,.25,0);function D(v,$){const Y=new F(v,.0075,3,64,$*Math.PI*2);return Y.rotateY(Math.PI/2),Y.rotateX(Math.PI/2),Y}function z(){const v=new ft;return v.setAttribute("position",new yt([0,0,0,1,1,1],3)),v}const N={X:[[new h(b,a),[.5,0,0],[0,0,-Math.PI/2]],[new h(b,a),[-.5,0,0],[0,0,Math.PI/2]],[new h(O,a),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new h(b,i),[0,.5,0]],[new h(b,i),[0,-.5,0],[Math.PI,0,0]],[new h(O,i)]],Z:[[new h(b,r),[0,0,.5],[Math.PI/2,0,0]],[new h(b,r),[0,0,-.5],[-Math.PI/2,0,0]],[new h(O,r),null,[Math.PI/2,0,0]]],XYZ:[[new h(new it(.1,0),f),[0,0,0]]],XY:[[new h(new E(.15,.15,.01),u),[.15,.15,0]]],YZ:[[new h(new E(.15,.15,.01),_),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new h(new E(.15,.15,.01),w),[.15,0,.15],[-Math.PI/2,0,0]]]},C={X:[[new h(new x(.2,0,.6,4),o),[.3,0,0],[0,0,-Math.PI/2]],[new h(new x(.2,0,.6,4),o),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new h(new x(.2,0,.6,4),o),[0,.3,0]],[new h(new x(.2,0,.6,4),o),[0,-.3,0],[0,0,Math.PI]]],Z:[[new h(new x(.2,0,.6,4),o),[0,0,.3],[Math.PI/2,0,0]],[new h(new x(.2,0,.6,4),o),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new h(new it(.2,0),o)]],XY:[[new h(new E(.2,.2,.01),o),[.15,.15,0]]],YZ:[[new h(new E(.2,.2,.01),o),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new h(new E(.2,.2,.01),o),[.15,0,.15],[-Math.PI/2,0,0]]]},Rt={START:[[new h(new it(.01,2),s),null,null,null,"helper"]],END:[[new h(new it(.01,2),s),null,null,null,"helper"]],DELTA:[[new X(z(),s),null,null,null,"helper"]],X:[[new X(g,s),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new X(g,s),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new X(g,s),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},Ot={XYZE:[[new h(D(.5,1),R),null,[0,Math.PI/2,0]]],X:[[new h(D(.5,.5),a)]],Y:[[new h(D(.5,.5),i),null,[0,0,-Math.PI/2]]],Z:[[new h(D(.5,.5),r),null,[0,Math.PI/2,0]]],E:[[new h(D(.75,1),S),null,[0,Math.PI/2,0]]]},Yt={AXIS:[[new X(g,s),[-1e3,0,0],null,[1e6,1,1],"helper"]]},Lt={XYZE:[[new h(new Ut(.25,10,8),o)]],X:[[new h(new F(.5,.1,4,24),o),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new h(new F(.5,.1,4,24),o),[0,0,0],[Math.PI/2,0,0]]],Z:[[new h(new F(.5,.1,4,24),o),[0,0,0],[0,0,-Math.PI/2]]],E:[[new h(new F(.75,.1,2,24),o)]]},jt={X:[[new h(c,a),[.5,0,0],[0,0,-Math.PI/2]],[new h(O,a),[0,0,0],[0,0,-Math.PI/2]],[new h(c,a),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new h(c,i),[0,.5,0]],[new h(O,i)],[new h(c,i),[0,-.5,0],[0,0,Math.PI]]],Z:[[new h(c,r),[0,0,.5],[Math.PI/2,0,0]],[new h(O,r),[0,0,0],[Math.PI/2,0,0]],[new h(c,r),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new h(new E(.15,.15,.01),u),[.15,.15,0]]],YZ:[[new h(new E(.15,.15,.01),_),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new h(new E(.15,.15,.01),w),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new h(new E(.1,.1,.1),f)]]},kt={X:[[new h(new x(.2,0,.6,4),o),[.3,0,0],[0,0,-Math.PI/2]],[new h(new x(.2,0,.6,4),o),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new h(new x(.2,0,.6,4),o),[0,.3,0]],[new h(new x(.2,0,.6,4),o),[0,-.3,0],[0,0,Math.PI]]],Z:[[new h(new x(.2,0,.6,4),o),[0,0,.3],[Math.PI/2,0,0]],[new h(new x(.2,0,.6,4),o),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new h(new E(.2,.2,.01),o),[.15,.15,0]]],YZ:[[new h(new E(.2,.2,.01),o),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new h(new E(.2,.2,.01),o),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new h(new E(.2,.2,.2),o),[0,0,0]]]},Xt={X:[[new X(g,s),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new X(g,s),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new X(g,s),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function k(v){const $=new dt;for(const Y in v)for(let U=v[Y].length;U--;){const M=v[Y][U][0].clone(),J=v[Y][U][1],tt=v[Y][U][2],et=v[Y][U][3],Zt=v[Y][U][4];M.name=Y,M.tag=Zt,J&&M.position.set(J[0],J[1],J[2]),tt&&M.rotation.set(tt[0],tt[1],tt[2]),et&&M.scale.set(et[0],et[1],et[2]),M.updateMatrix();const mt=M.geometry.clone();mt.applyMatrix4(M.matrix),M.geometry=mt,M.renderOrder=1/0,M.position.set(0,0,0),M.rotation.set(0,0,0),M.scale.set(1,1,1),$.add(M)}return $}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=k(N)),this.add(this.gizmo.rotate=k(Ot)),this.add(this.gizmo.scale=k(jt)),this.add(this.picker.translate=k(C)),this.add(this.picker.rotate=k(Lt)),this.add(this.picker.scale=k(kt)),this.add(this.helper.translate=k(Rt)),this.add(this.helper.rotate=k(Yt)),this.add(this.helper.scale=k(Xt)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(t){const o=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:rt;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(let a=0;a<s.length;a++){const i=s[a];i.visible=!0,i.rotation.set(0,0,0),i.position.copy(this.worldPosition);let r;if(this.camera.isOrthographicCamera?r=(this.camera.top-this.camera.bottom)/this.camera.zoom:r=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),i.scale.set(1,1,1).multiplyScalar(r*this.size/4),i.tag==="helper"){i.visible=!1,i.name==="AXIS"?(i.visible=!!this.axis,this.axis==="X"&&(m.setFromEuler(ot.set(0,0,0)),i.quaternion.copy(o).multiply(m),Math.abs(d.copy(B).applyQuaternion(o).dot(this.eye))>.9&&(i.visible=!1)),this.axis==="Y"&&(m.setFromEuler(ot.set(0,0,Math.PI/2)),i.quaternion.copy(o).multiply(m),Math.abs(d.copy(Q).applyQuaternion(o).dot(this.eye))>.9&&(i.visible=!1)),this.axis==="Z"&&(m.setFromEuler(ot.set(0,Math.PI/2,0)),i.quaternion.copy(o).multiply(m),Math.abs(d.copy(V).applyQuaternion(o).dot(this.eye))>.9&&(i.visible=!1)),this.axis==="XYZE"&&(m.setFromEuler(ot.set(0,Math.PI/2,0)),d.copy(this.rotationAxis),i.quaternion.setFromRotationMatrix(xt.lookAt(Mt,d,Q)),i.quaternion.multiply(m),i.visible=this.dragging),this.axis==="E"&&(i.visible=!1)):i.name==="START"?(i.position.copy(this.worldPositionStart),i.visible=this.dragging):i.name==="END"?(i.position.copy(this.worldPosition),i.visible=this.dragging):i.name==="DELTA"?(i.position.copy(this.worldPositionStart),i.quaternion.copy(this.worldQuaternionStart),P.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),P.applyQuaternion(this.worldQuaternionStart.clone().invert()),i.scale.copy(P),i.visible=this.dragging):(i.quaternion.copy(o),this.dragging?i.position.copy(this.worldPositionStart):i.position.copy(this.worldPosition),this.axis&&(i.visible=this.axis.search(i.name)!==-1));continue}i.quaternion.copy(o),this.mode==="translate"||this.mode==="scale"?(i.name==="X"&&Math.abs(d.copy(B).applyQuaternion(o).dot(this.eye))>.99&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),i.name==="Y"&&Math.abs(d.copy(Q).applyQuaternion(o).dot(this.eye))>.99&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),i.name==="Z"&&Math.abs(d.copy(V).applyQuaternion(o).dot(this.eye))>.99&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),i.name==="XY"&&Math.abs(d.copy(V).applyQuaternion(o).dot(this.eye))<.2&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),i.name==="YZ"&&Math.abs(d.copy(B).applyQuaternion(o).dot(this.eye))<.2&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),i.name==="XZ"&&Math.abs(d.copy(Q).applyQuaternion(o).dot(this.eye))<.2&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1)):this.mode==="rotate"&&(nt.copy(o),d.copy(this.eye).applyQuaternion(m.copy(o).invert()),i.name.search("E")!==-1&&i.quaternion.setFromRotationMatrix(xt.lookAt(this.eye,Mt,Q)),i.name==="X"&&(m.setFromAxisAngle(B,Math.atan2(-d.y,d.z)),m.multiplyQuaternions(nt,m),i.quaternion.copy(m)),i.name==="Y"&&(m.setFromAxisAngle(Q,Math.atan2(d.x,d.z)),m.multiplyQuaternions(nt,m),i.quaternion.copy(m)),i.name==="Z"&&(m.setFromAxisAngle(V,Math.atan2(d.y,d.x)),m.multiplyQuaternions(nt,m),i.quaternion.copy(m))),i.visible=i.visible&&(i.name.indexOf("X")===-1||this.showX),i.visible=i.visible&&(i.name.indexOf("Y")===-1||this.showY),i.visible=i.visible&&(i.name.indexOf("Z")===-1||this.showZ),i.visible=i.visible&&(i.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),i.material._color=i.material._color||i.material.color.clone(),i.material._opacity=i.material._opacity||i.material.opacity,i.material.color.copy(i.material._color),i.material.opacity=i.material._opacity,this.enabled&&this.axis&&(i.name===this.axis?(i.material.color.copy(this.materialLib.active.color),i.material.opacity=1):this.axis.split("").some(function(_){return i.name===_})&&(i.material.color.copy(this.materialLib.active.color),i.material.opacity=1))}super.updateMatrixWorld(t)}}class me extends h{constructor(){super(new Wt(1e5,1e5,2,2),new vt({visible:!1,wireframe:!0,side:Ft,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(t){let e=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(e="local"),at.copy(B).applyQuaternion(e==="local"?this.worldQuaternion:rt),G.copy(Q).applyQuaternion(e==="local"?this.worldQuaternion:rt),K.copy(V).applyQuaternion(e==="local"?this.worldQuaternion:rt),d.copy(G),this.mode){case"translate":case"scale":switch(this.axis){case"X":d.copy(this.eye).cross(at),j.copy(at).cross(d);break;case"Y":d.copy(this.eye).cross(G),j.copy(G).cross(d);break;case"Z":d.copy(this.eye).cross(K),j.copy(K).cross(d);break;case"XY":j.copy(K);break;case"YZ":j.copy(at);break;case"XZ":d.copy(K),j.copy(G);break;case"XYZ":case"E":j.set(0,0,0);break}break;default:j.set(0,0,0)}j.length()===0?this.quaternion.copy(this.cameraQuaternion):(Tt.lookAt(P.set(0,0,0),j,d),this.quaternion.setFromRotationMatrix(Tt)),super.updateMatrixWorld(t)}}var ht=function(){var n=0,t=document.createElement("div");t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",function(u){u.preventDefault(),o(++n%t.children.length)},!1);function e(u){return t.appendChild(u.dom),u}function o(u){for(var f=0;f<t.children.length;f++)t.children[f].style.display=f===u?"block":"none";n=u}var s=(performance||Date).now(),a=s,i=0,r=e(new ht.Panel("FPS","#0ff","#002")),_=e(new ht.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var w=e(new ht.Panel("MB","#f08","#201"));return o(0),{REVISION:16,dom:t,addPanel:e,showPanel:o,begin:function(){s=(performance||Date).now()},end:function(){i++;var u=(performance||Date).now();if(_.update(u-s,200),u>=a+1e3&&(r.update(i*1e3/(u-a),100),a=u,i=0,w)){var f=performance.memory;w.update(f.usedJSHeapSize/1048576,f.jsHeapSizeLimit/1048576)}return u},update:function(){s=this.end()},domElement:t,setMode:o}};ht.Panel=function(n,t,e){var o=1/0,s=0,a=Math.round,i=a(window.devicePixelRatio||1),r=80*i,_=48*i,w=3*i,u=2*i,f=3*i,S=15*i,I=74*i,R=30*i,b=document.createElement("canvas");b.width=r,b.height=_,b.style.cssText="width:80px;height:48px";var c=b.getContext("2d");return c.font="bold "+9*i+"px Helvetica,Arial,sans-serif",c.textBaseline="top",c.fillStyle=e,c.fillRect(0,0,r,_),c.fillStyle=t,c.fillText(n,w,u),c.fillRect(f,S,I,R),c.fillStyle=e,c.globalAlpha=.9,c.fillRect(f,S,I,R),{dom:b,update:function(g,O){o=Math.min(o,g),s=Math.max(s,g),c.fillStyle=e,c.globalAlpha=1,c.fillRect(0,0,r,S),c.fillStyle=t,c.fillText(a(g)+" "+n+" ("+a(o)+"-"+a(s)+")",w,u),c.drawImage(b,f+i,S,I-i,R,f,S,I-i,R),c.fillRect(f+I-i,S,i,R),c.fillStyle=e,c.globalAlpha=.9,c.fillRect(f+I-i,S,i,a((1-g/O)*R))}}};export{fe as O,ht as S,ye as T};
