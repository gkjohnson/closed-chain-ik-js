import{a as fe,a2 as nt,J as Ue,L as Se,aV as Wn,aW as Kn,ai as $e,ak as Pt,x as et,C as tt,an as ke,n as Ze,V as he,_ as Ae,aX as Yn,av as Xn,aj as qt,q as we,j as _t,S as Zn,as as Gt,E as Fe,aL as Lt,aY as Qn,aa as Ve,aT as De,f as $n,s as ei,F as ti,P as jt,aK as ni,A as ii,ao as si,ap as oi,D as ri,G as Ft,Q as it,aQ as Rt,aS as ai,a4 as ci,X as Vt,a5 as li,M as je,a0 as ui,aH as di,a3 as fi,aB as Pe,aD as Mt,U as hi,aZ as pi,Z as mi,i as gi,Y as bi}from"./IKRootsHelper-DmBdh0X7.js";const qe=new Float64Array(3),Ge=new Float64Array(3),Re=new nt;function yi(E,o=!1,b=!0){let c=null,L,M=!0;if(E.isURDFRobot)c=new Ue,c.name="__world_joint__",c.setDoF(fe.X,fe.Y,fe.Z,fe.EX,fe.EY,fe.EZ),L=new Se,L.name=E.name,c.addChild(L);else if(E.isURDFLink)L=new Se,L.name=E.name,M=!o;else if(E.isURDFJoint){c=new Ue;const j=E.jointType;switch(j){case"continuous":case"revolute":case"prismatic":{const z=new Se;c.addChild(z);const F=new Ue;F.name=E.name,z.addChild(F);const D=new Se;F.addChild(D);const $=new Ue;D.addChild($),qe[0]=0,qe[1]=0,qe[2]=1,Ge[0]=E.axis.x,Ge[1]=E.axis.y,Ge[2]=E.axis.z,Wn(F.quaternion,qe,Ge),Kn($.quaternion,F.quaternion),F.setMatrixNeedsUpdate(),$.setMatrixNeedsUpdate(),j==="revolute"||j==="continuous"?F.setDoF(fe.EZ):F.setDoF(fe.Z),j!=="continuous"&&(F.setMinLimits(E.limit.lower),F.setMaxLimits(E.limit.upper)),L=$;break}case"fixed":{L=c,M=!o;break}case"planar":case"floating":default:console.error(`urdfRobotToIKRoot: Joint type ${j} not supported.`),M=!o}}else return null;b||((c||L).setPosition(E.position.x,E.position.y,E.position.z),(c||L).setQuaternion(E.quaternion.x,E.quaternion.y,E.quaternion.z,E.quaternion.w));const ie=E.children;for(let j=0,z=ie.length;j<z;j++){const F=yi(ie[j],o,!1);F&&(L.addChild(F),M=!0)}return!o||M?c||L:null}function Ci(E,o){E.setDoFValue(fe.X,o.position.x),E.setDoFValue(fe.Y,o.position.y),E.setDoFValue(fe.Z,o.position.z),Re.copy(o.rotation),Re.reorder("ZYX"),E.setDoFValue(fe.EX,Re.x),E.setDoFValue(fe.EY,Re.y),E.setDoFValue(fe.EZ,Re.z),E.traverse(b=>{if(b.isJoint){const c=b.name;c in o.joints&&b.setDoFValues(o.joints[c].angle)}})}function _i(E,o){o.updateMatrixWorld(),E.matrix.set(...o.matrixWorld).transpose(),E.matrix.decompose(E.position,E.quaternion,E.scale),o.traverse(b=>{if(b.isJoint){const c=b,L=E.joints[b.name];L&&(L.jointType==="prismatic"?L.setJointValue(c.getDoFValue(fe.Z)):L.setJointValue(c.getDoFValue(fe.EZ)))}})}class wi extends $e{constructor(o){super(o)}load(o,b,c,L){const M=this,ie=new Pt(this.manager);ie.setPath(this.path),ie.setResponseType("arraybuffer"),ie.setRequestHeader(this.requestHeader),ie.setWithCredentials(this.withCredentials),ie.load(o,function(j){try{b(M.parse(j))}catch(z){L?L(z):console.error(z),M.manager.itemError(o)}},c,L)}parse(o){function b(F){const D=new DataView(F),$=32/8*3+32/8*3*3+16/8,ce=D.getUint32(80,!0);if(80+32/8+ce*$===D.byteLength)return!0;const se=[115,111,108,105,100];for(let H=0;H<5;H++)if(c(se,D,H))return!1;return!0}function c(F,D,$){for(let ce=0,Z=F.length;ce<Z;ce++)if(F[ce]!==D.getUint8($+ce))return!1;return!0}function L(F){const D=new DataView(F),$=D.getUint32(80,!0);let ce,Z,se,H=!1,de,ge,P,G,J;for(let x=0;x<70;x++)D.getUint32(x,!1)==1129270351&&D.getUint8(x+4)==82&&D.getUint8(x+5)==61&&(H=!0,de=new Float32Array($*3*3),ge=D.getUint8(x+6)/255,P=D.getUint8(x+7)/255,G=D.getUint8(x+8)/255,J=D.getUint8(x+9)/255);const A=84,S=12*4+2,U=new et,p=new Float32Array($*3*3),f=new Float32Array($*3*3),v=new tt;for(let x=0;x<$;x++){const w=A+x*S,B=D.getFloat32(w,!0),ue=D.getFloat32(w+4,!0),re=D.getFloat32(w+8,!0);if(H){const d=D.getUint16(w+48,!0);(d&32768)===0?(ce=(d&31)/31,Z=(d>>5&31)/31,se=(d>>10&31)/31):(ce=ge,Z=P,se=G)}for(let d=1;d<=3;d++){const te=w+d*12,O=x*3*3+(d-1)*3;p[O]=D.getFloat32(te,!0),p[O+1]=D.getFloat32(te+4,!0),p[O+2]=D.getFloat32(te+8,!0),f[O]=B,f[O+1]=ue,f[O+2]=re,H&&(v.setRGB(ce,Z,se,ke),de[O]=v.r,de[O+1]=v.g,de[O+2]=v.b)}}return U.setAttribute("position",new Ze(p,3)),U.setAttribute("normal",new Ze(f,3)),H&&(U.setAttribute("color",new Ze(de,3)),U.hasColors=!0,U.alpha=J),U}function M(F){const D=new et,$=/solid([\s\S]*?)endsolid/g,ce=/facet([\s\S]*?)endfacet/g,Z=/solid\s(.+)/;let se=0;const H=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,de=new RegExp("vertex"+H+H+H,"g"),ge=new RegExp("normal"+H+H+H,"g"),P=[],G=[],J=[],A=new he;let S,U=0,p=0,f=0;for(;(S=$.exec(F))!==null;){p=f;const v=S[0],x=(S=Z.exec(v))!==null?S[1]:"";for(J.push(x);(S=ce.exec(v))!==null;){let ue=0,re=0;const d=S[0];for(;(S=ge.exec(d))!==null;)A.x=parseFloat(S[1]),A.y=parseFloat(S[2]),A.z=parseFloat(S[3]),re++;for(;(S=de.exec(d))!==null;)P.push(parseFloat(S[1]),parseFloat(S[2]),parseFloat(S[3])),G.push(A.x,A.y,A.z),ue++,f++;re!==1&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+se),ue!==3&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+se),se++}const w=p,B=f-p;D.userData.groupNames=J,D.addGroup(w,B,U),U++}return D.setAttribute("position",new Ae(P,3)),D.setAttribute("normal",new Ae(G,3)),D}function ie(F){return typeof F!="string"?new TextDecoder().decode(F):F}function j(F){if(typeof F=="string"){const D=new Uint8Array(F.length);for(let $=0;$<F.length;$++)D[$]=F.charCodeAt($)&255;return D.buffer||D}else return F}const z=j(o);return b(z)?L(z):M(ie(o))}}class vt extends Yn{constructor(o){super(o)}parse(o){function b(d){switch(d.image_type){case ce:case H:if(d.colormap_length>256||d.colormap_size!==24||d.colormap_type!==1)throw new Error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case Z:case se:case de:case ge:if(d.colormap_type)throw new Error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case $:throw new Error("THREE.TGALoader: No data.");default:throw new Error("THREE.TGALoader: Invalid type "+d.image_type)}if(d.width<=0||d.height<=0)throw new Error("THREE.TGALoader: Invalid image size.");if(d.pixel_size!==8&&d.pixel_size!==16&&d.pixel_size!==24&&d.pixel_size!==32)throw new Error("THREE.TGALoader: Invalid pixel size "+d.pixel_size)}function c(d,te,O,Q,ae){let Y,ee;const q=O.pixel_size>>3,I=O.width*O.height*q;if(te&&(ee=ae.subarray(Q,Q+=O.colormap_length*(O.colormap_size>>3))),d){Y=new Uint8Array(I);let _,g,R,ne=0;const be=new Uint8Array(q);for(;ne<I;)if(_=ae[Q++],g=(_&127)+1,_&128){for(R=0;R<q;++R)be[R]=ae[Q++];for(R=0;R<g;++R)Y.set(be,ne+R*q);ne+=q*g}else{for(g*=q,R=0;R<g;++R)Y[ne+R]=ae[Q++];ne+=g}}else Y=ae.subarray(Q,Q+=te?O.width*O.height:I);return{pixel_data:Y,palettes:ee}}function L(d,te,O,Q,ae,Y,ee,q,I){const _=I;let g,R=0,ne,be;const Te=v.width;for(be=te;be!==Q;be+=O)for(ne=ae;ne!==ee;ne+=Y,R++)g=q[R],d[(ne+Te*be)*4+3]=255,d[(ne+Te*be)*4+2]=_[g*3+0],d[(ne+Te*be)*4+1]=_[g*3+1],d[(ne+Te*be)*4+0]=_[g*3+2];return d}function M(d,te,O,Q,ae,Y,ee,q){let I,_=0,g,R;const ne=v.width;for(R=te;R!==Q;R+=O)for(g=ae;g!==ee;g+=Y,_+=2)I=q[_+0]+(q[_+1]<<8),d[(g+ne*R)*4+0]=(I&31744)>>7,d[(g+ne*R)*4+1]=(I&992)>>2,d[(g+ne*R)*4+2]=(I&31)<<3,d[(g+ne*R)*4+3]=I&32768?0:255;return d}function ie(d,te,O,Q,ae,Y,ee,q){let I=0,_,g;const R=v.width;for(g=te;g!==Q;g+=O)for(_=ae;_!==ee;_+=Y,I+=3)d[(_+R*g)*4+3]=255,d[(_+R*g)*4+2]=q[I+0],d[(_+R*g)*4+1]=q[I+1],d[(_+R*g)*4+0]=q[I+2];return d}function j(d,te,O,Q,ae,Y,ee,q){let I=0,_,g;const R=v.width;for(g=te;g!==Q;g+=O)for(_=ae;_!==ee;_+=Y,I+=4)d[(_+R*g)*4+2]=q[I+0],d[(_+R*g)*4+1]=q[I+1],d[(_+R*g)*4+0]=q[I+2],d[(_+R*g)*4+3]=q[I+3];return d}function z(d,te,O,Q,ae,Y,ee,q){let I,_=0,g,R;const ne=v.width;for(R=te;R!==Q;R+=O)for(g=ae;g!==ee;g+=Y,_++)I=q[_],d[(g+ne*R)*4+0]=I,d[(g+ne*R)*4+1]=I,d[(g+ne*R)*4+2]=I,d[(g+ne*R)*4+3]=255;return d}function F(d,te,O,Q,ae,Y,ee,q){let I=0,_,g;const R=v.width;for(g=te;g!==Q;g+=O)for(_=ae;_!==ee;_+=Y,I+=2)d[(_+R*g)*4+0]=q[I+0],d[(_+R*g)*4+1]=q[I+0],d[(_+R*g)*4+2]=q[I+0],d[(_+R*g)*4+3]=q[I+1];return d}function D(d,te,O,Q,ae){let Y,ee,q,I,_,g;switch((v.flags&P)>>G){default:case S:Y=0,q=1,_=te,ee=0,I=1,g=O;break;case J:Y=0,q=1,_=te,ee=O-1,I=-1,g=-1;break;case U:Y=te-1,q=-1,_=-1,ee=0,I=1,g=O;break;case A:Y=te-1,q=-1,_=-1,ee=O-1,I=-1,g=-1;break}if(B)switch(v.pixel_size){case 8:z(d,ee,I,g,Y,q,_,Q);break;case 16:F(d,ee,I,g,Y,q,_,Q);break;default:throw new Error("THREE.TGALoader: Format not supported.")}else switch(v.pixel_size){case 8:L(d,ee,I,g,Y,q,_,Q,ae);break;case 16:M(d,ee,I,g,Y,q,_,Q);break;case 24:ie(d,ee,I,g,Y,q,_,Q);break;case 32:j(d,ee,I,g,Y,q,_,Q);break;default:throw new Error("THREE.TGALoader: Format not supported.")}return d}const $=0,ce=1,Z=2,se=3,H=9,de=10,ge=11,P=48,G=4,J=0,A=1,S=2,U=3;if(o.length<19)throw new Error("THREE.TGALoader: Not enough data to contain header.");let p=0;const f=new Uint8Array(o),v={id_length:f[p++],colormap_type:f[p++],image_type:f[p++],colormap_index:f[p++]|f[p++]<<8,colormap_length:f[p++]|f[p++]<<8,colormap_size:f[p++],origin:[f[p++]|f[p++]<<8,f[p++]|f[p++]<<8],width:f[p++]|f[p++]<<8,height:f[p++]|f[p++]<<8,pixel_size:f[p++],flags:f[p++]};if(b(v),v.id_length+p>o.length)throw new Error("THREE.TGALoader: No data.");p+=v.id_length;let x=!1,w=!1,B=!1;switch(v.image_type){case H:x=!0,w=!0;break;case ce:w=!0;break;case de:x=!0;break;case Z:break;case ge:x=!0,B=!0;break;case se:B=!0;break}const ue=new Uint8Array(v.width*v.height*4),re=c(x,w,v,p,f);return D(ue,v.width,v.height,re.pixel_data,re.palettes),{data:ue,width:v.width,height:v.height,flipY:!0,generateMipmaps:!0,minFilter:Xn}}}class ki extends $e{load(o,b,c,L){const M=this,ie=M.path===""?qt.extractUrlBase(o):M.path,j=new Pt(M.manager);j.setPath(M.path),j.setRequestHeader(M.requestHeader),j.setWithCredentials(M.withCredentials),j.load(o,function(z){try{b(M.parse(z,ie))}catch(F){L?L(F):console.error(F),M.manager.itemError(o)}},c,L)}parse(o,b){function c(t,e){const i=[],n=t.childNodes;for(let s=0,r=n.length;s<r;s++){const a=n[s];a.nodeName===e&&i.push(a)}return i}function L(t){if(t.length===0)return[];const e=t.trim().split(/\s+/),i=new Array(e.length);for(let n=0,s=e.length;n<s;n++)i[n]=e[n];return i}function M(t){if(t.length===0)return[];const e=t.trim().split(/\s+/),i=new Array(e.length);for(let n=0,s=e.length;n<s;n++)i[n]=parseFloat(e[n]);return i}function ie(t){if(t.length===0)return[];const e=t.trim().split(/\s+/),i=new Array(e.length);for(let n=0,s=e.length;n<s;n++)i[n]=parseInt(e[n]);return i}function j(t){return t.substring(1)}function z(){return"three_default_"+Hn++}function F(t){return Object.keys(t).length===0}function D(t){return{unit:$(c(t,"unit")[0]),upAxis:ce(c(t,"up_axis")[0])}}function $(t){return t!==void 0&&t.hasAttribute("meter")===!0?parseFloat(t.getAttribute("meter")):1}function ce(t){return t!==void 0?t.textContent:"Y_UP"}function Z(t,e,i,n){const s=c(t,e)[0];if(s!==void 0){const r=c(s,i);for(let a=0;a<r.length;a++)n(r[a])}}function se(t,e){for(const i in t){const n=t[i];n.build=e(t[i])}}function H(t,e){return t.build!==void 0||(t.build=e(t)),t.build}function de(t){const e={sources:{},samplers:{},channels:{}};let i=!1;for(let n=0,s=t.childNodes.length;n<s;n++){const r=t.childNodes[n];if(r.nodeType!==1)continue;let a;switch(r.nodeName){case"source":a=r.getAttribute("id"),e.sources[a]=We(r);break;case"sampler":a=r.getAttribute("id"),e.samplers[a]=ge(r);break;case"channel":a=r.getAttribute("target"),e.channels[a]=P(r);break;case"animation":de(r),i=!0;break;default:console.log(r)}}i===!1&&(V.animations[t.getAttribute("id")||Fe.generateUUID()]=e)}function ge(t){const e={inputs:{}};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"input":const r=j(s.getAttribute("source")),a=s.getAttribute("semantic");e.inputs[a]=r;break}}return e}function P(t){const e={};let n=t.getAttribute("target").split("/");const s=n.shift();let r=n.shift();const a=r.indexOf("(")!==-1,m=r.indexOf(".")!==-1;if(m)n=r.split("."),r=n.shift(),e.member=n.shift();else if(a){const u=r.split("(");r=u.shift();for(let h=0;h<u.length;h++)u[h]=parseInt(u[h].replace(/\)/,""));e.indices=u}return e.id=s,e.sid=r,e.arraySyntax=a,e.memberSyntax=m,e.sampler=j(t.getAttribute("source")),e}function G(t){const e=[],i=t.channels,n=t.samplers,s=t.sources;for(const r in i)if(i.hasOwnProperty(r)){const a=i[r],m=n[a.sampler],u=m.inputs.INPUT,h=m.inputs.OUTPUT,N=s[u],l=s[h],k=A(a,N,l);v(k,e)}return e}function J(t){return H(V.animations[t],G)}function A(t,e,i){const n=V.nodes[t.id],s=Ce(n.id),r=n.transforms[t.sid],a=n.matrix.clone().transpose();let m,u,h,N,l,k;const y={};switch(r){case"matrix":for(h=0,N=e.array.length;h<N;h++)if(m=e.array[h],u=h*i.stride,y[m]===void 0&&(y[m]={}),t.arraySyntax===!0){const oe=i.array[u],X=t.indices[0]+4*t.indices[1];y[m][X]=oe}else for(l=0,k=i.stride;l<k;l++)y[m][l]=i.array[u+l];break;case"translate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',r);break;case"rotate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',r);break;case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',r);break}const C=S(y,a);return{name:s.uuid,keyframes:C}}function S(t,e){const i=[];for(const s in t)i.push({time:parseFloat(s),value:t[s]});i.sort(n);for(let s=0;s<16;s++)x(i,s,e.elements[s]);return i;function n(s,r){return s.time-r.time}}const U=new he,p=new he,f=new it;function v(t,e){const i=t.keyframes,n=t.name,s=[],r=[],a=[],m=[];for(let u=0,h=i.length;u<h;u++){const N=i[u],l=N.time,k=N.value;me.fromArray(k).transpose(),me.decompose(U,f,p),s.push(l),r.push(U.x,U.y,U.z),a.push(f.x,f.y,f.z,f.w),m.push(p.x,p.y,p.z)}return r.length>0&&e.push(new Rt(n+".position",s,r)),a.length>0&&e.push(new ai(n+".quaternion",s,a)),m.length>0&&e.push(new Rt(n+".scale",s,m)),e}function x(t,e,i){let n,s=!0,r,a;for(r=0,a=t.length;r<a;r++)n=t[r],n.value[e]===void 0?n.value[e]=null:s=!1;if(s===!0)for(r=0,a=t.length;r<a;r++)n=t[r],n.value[e]=i;else w(t,e)}function w(t,e){let i,n;for(let s=0,r=t.length;s<r;s++){const a=t[s];if(a.value[e]===null){if(i=B(t,s,e),n=ue(t,s,e),i===null){a.value[e]=n.value[e];continue}if(n===null){a.value[e]=i.value[e];continue}re(a,i,n,e)}}}function B(t,e,i){for(;e>=0;){const n=t[e];if(n.value[i]!==null)return n;e--}return null}function ue(t,e,i){for(;e<t.length;){const n=t[e];if(n.value[i]!==null)return n;e++}return null}function re(t,e,i,n){if(i.time-e.time===0){t.value[n]=e.value[n];return}t.value[n]=(t.time-e.time)*(i.value[n]-e.value[n])/(i.time-e.time)+e.value[n]}function d(t){const e={name:t.getAttribute("id")||"default",start:parseFloat(t.getAttribute("start")||0),end:parseFloat(t.getAttribute("end")||0),animations:[]};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"instance_animation":e.animations.push(j(s.getAttribute("url")));break}}V.clips[t.getAttribute("id")]=e}function te(t){const e=[],i=t.name,n=t.end-t.start||-1,s=t.animations;for(let r=0,a=s.length;r<a;r++){const m=J(s[r]);for(let u=0,h=m.length;u<h;u++)e.push(m[u])}return new Lt(i,n,e)}function O(t){return H(V.clips[t],te)}function Q(t){const e={};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"skin":e.id=j(s.getAttribute("source")),e.skin=ae(s);break;case"morph":e.id=j(s.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.");break}}V.controllers[t.getAttribute("id")]=e}function ae(t){const e={sources:{}};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"bind_shape_matrix":e.bindShapeMatrix=M(s.textContent);break;case"source":const r=s.getAttribute("id");e.sources[r]=We(s);break;case"joints":e.joints=Y(s);break;case"vertex_weights":e.vertexWeights=ee(s);break}}return e}function Y(t){const e={inputs:{}};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"input":const r=s.getAttribute("semantic"),a=j(s.getAttribute("source"));e.inputs[r]=a;break}}return e}function ee(t){const e={inputs:{}};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"input":const r=s.getAttribute("semantic"),a=j(s.getAttribute("source")),m=parseInt(s.getAttribute("offset"));e.inputs[r]={id:a,offset:m};break;case"vcount":e.vcount=ie(s.textContent);break;case"v":e.v=ie(s.textContent);break}}return e}function q(t){const e={id:t.id},i=V.geometries[e.id];return t.skin!==void 0&&(e.skin=I(t.skin),i.sources.skinIndices=e.skin.indices,i.sources.skinWeights=e.skin.weights),e}function I(t){const i={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},n=t.sources,s=t.vertexWeights,r=s.vcount,a=s.v,m=s.inputs.JOINT.offset,u=s.inputs.WEIGHT.offset,h=t.sources[t.joints.inputs.JOINT],N=t.sources[t.joints.inputs.INV_BIND_MATRIX],l=n[s.inputs.WEIGHT.id].array;let k=0,y,C,T;for(y=0,T=r.length;y<T;y++){const X=r[y],W=[];for(C=0;C<X;C++){const K=a[k+m],Ne=a[k+u],pe=l[Ne];W.push({index:K,weight:pe}),k+=2}for(W.sort(oe),C=0;C<4;C++){const K=W[C];K!==void 0?(i.indices.array.push(K.index),i.weights.array.push(K.weight)):(i.indices.array.push(0),i.weights.array.push(0))}}for(t.bindShapeMatrix?i.bindMatrix=new we().fromArray(t.bindShapeMatrix).transpose():i.bindMatrix=new we().identity(),y=0,T=h.array.length;y<T;y++){const X=h.array[y],W=new we().fromArray(N.array,y*N.stride).transpose();i.joints.push({name:X,boneInverse:W})}return i;function oe(X,W){return W.weight-X.weight}}function _(t){return H(V.controllers[t],q)}function g(t){const e={init_from:c(t,"init_from")[0].textContent};V.images[t.getAttribute("id")]=e}function R(t){return t.build!==void 0?t.build:t.init_from}function ne(t){const e=V.images[t];return e!==void 0?H(e,R):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",t),null)}function be(t){const e={};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"profile_COMMON":e.profile=Te(s);break}}V.effects[t.getAttribute("id")]=e}function Te(t){const e={surfaces:{},samplers:{}};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"newparam":Bt(s,e);break;case"technique":e.technique=Wt(s);break;case"extra":e.extra=rt(s);break}}return e}function Bt(t,e){const i=t.getAttribute("sid");for(let n=0,s=t.childNodes.length;n<s;n++){const r=t.childNodes[n];if(r.nodeType===1)switch(r.nodeName){case"surface":e.surfaces[i]=Ht(r);break;case"sampler2D":e.samplers[i]=zt(r);break}}}function Ht(t){const e={};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"init_from":e.init_from=s.textContent;break}}return e}function zt(t){const e={};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"source":e.source=s.textContent;break}}return e}function Wt(t){const e={};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"constant":case"lambert":case"blinn":case"phong":e.type=s.nodeName,e.parameters=Kt(s);break;case"extra":e.extra=rt(s);break}}return e}function Kt(t){const e={};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":e[s.nodeName]=st(s);break;case"transparent":e[s.nodeName]={opaque:s.hasAttribute("opaque")?s.getAttribute("opaque"):"A_ONE",data:st(s)};break}}return e}function st(t){const e={};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"color":e[s.nodeName]=M(s.textContent);break;case"float":e[s.nodeName]=parseFloat(s.textContent);break;case"texture":e[s.nodeName]={id:s.getAttribute("texture"),extra:ot(s)};break}}return e}function ot(t){const e={technique:{}};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"extra":Yt(s,e);break}}return e}function Yt(t,e){for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"technique":Xt(s,e);break}}}function Xt(t,e){for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":e.technique[s.nodeName]=parseFloat(s.textContent);break;case"wrapU":case"wrapV":s.textContent.toUpperCase()==="TRUE"?e.technique[s.nodeName]=1:s.textContent.toUpperCase()==="FALSE"?e.technique[s.nodeName]=0:e.technique[s.nodeName]=parseInt(s.textContent);break;case"bump":e[s.nodeName]=at(s);break}}}function rt(t){const e={};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"technique":e.technique=Zt(s);break}}return e}function Zt(t){const e={};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"double_sided":e[s.nodeName]=parseInt(s.textContent);break;case"bump":e[s.nodeName]=at(s);break}}return e}function at(t){const e={};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"texture":e[s.nodeName]={id:s.getAttribute("texture"),texcoord:s.getAttribute("texcoord"),extra:ot(s)};break}}return e}function ct(t){return t}function Qt(t){return H(V.effects[t],ct)}function $t(t){const e={name:t.getAttribute("name")};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"instance_effect":e.url=j(s.getAttribute("url"));break}}V.materials[t.getAttribute("id")]=e}function en(t){let e,i=t.slice((t.lastIndexOf(".")-1>>>0)+2);switch(i=i.toLowerCase(),i){case"tga":e=Xe;break;default:e=Tt}return e}function lt(t){const e=Qt(t.url),i=e.profile.technique;let n;switch(i.type){case"phong":case"blinn":n=new Ve;break;case"lambert":n=new Qn;break;default:n=new _t;break}n.name=t.name||"";function s(u,h=null){const N=e.profile.samplers[u.id];let l=null;if(N!==void 0){const k=e.profile.surfaces[N.source];l=ne(k.init_from)}else console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),l=ne(u.id);if(l!==null){const k=en(l);if(k!==void 0){const y=k.load(l),C=u.extra;if(C!==void 0&&C.technique!==void 0&&F(C.technique)===!1){const T=C.technique;y.wrapS=T.wrapU?Pe:Mt,y.wrapT=T.wrapV?Pe:Mt,y.offset.set(T.offsetU||0,T.offsetV||0),y.repeat.set(T.repeatU||1,T.repeatV||1)}else y.wrapS=Pe,y.wrapT=Pe;return h!==null&&(y.colorSpace=h),y}else return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",l),null}else return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",u.id),null}const r=i.parameters;for(const u in r){const h=r[u];switch(u){case"diffuse":h.color&&n.color.fromArray(h.color),h.texture&&(n.map=s(h.texture,ke));break;case"specular":h.color&&n.specular&&n.specular.fromArray(h.color),h.texture&&(n.specularMap=s(h.texture));break;case"bump":h.texture&&(n.normalMap=s(h.texture));break;case"ambient":h.texture&&(n.lightMap=s(h.texture,ke));break;case"shininess":h.float&&n.shininess&&(n.shininess=h.float);break;case"emission":h.color&&n.emissive&&n.emissive.fromArray(h.color),h.texture&&(n.emissiveMap=s(h.texture,ke));break}}De.colorSpaceToWorking(n.color,ke),n.specular&&De.colorSpaceToWorking(n.specular,ke),n.emissive&&De.colorSpaceToWorking(n.emissive,ke);let a=r.transparent,m=r.transparency;if(m===void 0&&a&&(m={float:1}),a===void 0&&m&&(a={opaque:"A_ONE",data:{color:[1,1,1,1]}}),a&&m)if(a.data.texture)n.transparent=!0;else{const u=a.data.color;switch(a.opaque){case"A_ONE":n.opacity=u[3]*m.float;break;case"RGB_ZERO":n.opacity=1-u[0]*m.float;break;case"A_ZERO":n.opacity=1-u[3]*m.float;break;case"RGB_ONE":n.opacity=u[0]*m.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',a.opaque)}n.opacity<1&&(n.transparent=!0)}if(i.extra!==void 0&&i.extra.technique!==void 0){const u=i.extra.technique;for(const h in u){const N=u[h];switch(h){case"double_sided":n.side=N===1?ei:ti;break;case"bump":n.normalMap=s(N.texture),n.normalScale=new $n(1,1);break}}}return n}function tn(t){return H(V.materials[t],lt)}function nn(t){const e={name:t.getAttribute("name")};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"optics":e.optics=sn(s);break}}V.cameras[t.getAttribute("id")]=e}function sn(t){for(let e=0;e<t.childNodes.length;e++){const i=t.childNodes[e];switch(i.nodeName){case"technique_common":return on(i)}}return{}}function on(t){const e={};for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];switch(n.nodeName){case"perspective":case"orthographic":e.technique=n.nodeName,e.parameters=rn(n);break}}return e}function rn(t){const e={};for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];switch(n.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":e[n.nodeName]=parseFloat(n.textContent);break}}return e}function ut(t){let e;switch(t.optics.technique){case"perspective":e=new jt(t.optics.parameters.yfov,t.optics.parameters.aspect_ratio,t.optics.parameters.znear,t.optics.parameters.zfar);break;case"orthographic":let i=t.optics.parameters.ymag,n=t.optics.parameters.xmag;const s=t.optics.parameters.aspect_ratio;n=n===void 0?i*s:n,i=i===void 0?n/s:i,n*=.5,i*=.5,e=new ni(-n,n,i,-i,t.optics.parameters.znear,t.optics.parameters.zfar);break;default:e=new jt;break}return e.name=t.name||"",e}function an(t){const e=V.cameras[t];return e!==void 0?H(e,ut):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",t),null)}function cn(t){let e={};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"technique_common":e=ln(s);break}}V.lights[t.getAttribute("id")]=e}function ln(t){const e={};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"directional":case"point":case"spot":case"ambient":e.technique=s.nodeName,e.parameters=un(s)}}return e}function un(t){const e={};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"color":const r=M(s.textContent);e.color=new tt().fromArray(r),De.colorSpaceToWorking(e.color,ke);break;case"falloff_angle":e.falloffAngle=parseFloat(s.textContent);break;case"quadratic_attenuation":const a=parseFloat(s.textContent);e.distance=a?Math.sqrt(1/a):0;break}}return e}function dt(t){let e;switch(t.technique){case"directional":e=new ri;break;case"point":e=new oi;break;case"spot":e=new si;break;case"ambient":e=new ii;break}return t.parameters.color&&e.color.copy(t.parameters.color),t.parameters.distance&&(e.distance=t.parameters.distance),e}function dn(t){const e=V.lights[t];return e!==void 0?H(e,dt):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",t),null)}function fn(t){const e={name:t.getAttribute("name"),sources:{},vertices:{},primitives:[]},i=c(t,"mesh")[0];if(i!==void 0){for(let n=0;n<i.childNodes.length;n++){const s=i.childNodes[n];if(s.nodeType!==1)continue;const r=s.getAttribute("id");switch(s.nodeName){case"source":e.sources[r]=We(s);break;case"vertices":e.vertices=hn(s);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",s.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":e.primitives.push(pn(s));break;default:console.log(s)}}V.geometries[t.getAttribute("id")]=e}}function We(t){const e={array:[],stride:3};for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];if(n.nodeType===1)switch(n.nodeName){case"float_array":e.array=M(n.textContent);break;case"Name_array":e.array=L(n.textContent);break;case"technique_common":const s=c(n,"accessor")[0];s!==void 0&&(e.stride=parseInt(s.getAttribute("stride")));break}}return e}function hn(t){const e={};for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];n.nodeType===1&&(e[n.getAttribute("semantic")]=j(n.getAttribute("source")))}return e}function pn(t){const e={type:t.nodeName,material:t.getAttribute("material"),count:parseInt(t.getAttribute("count")),inputs:{},stride:0,hasUV:!1};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"input":const r=j(s.getAttribute("source")),a=s.getAttribute("semantic"),m=parseInt(s.getAttribute("offset")),u=parseInt(s.getAttribute("set")),h=u>0?a+u:a;e.inputs[h]={id:r,offset:m},e.stride=Math.max(e.stride,m+1),a==="TEXCOORD"&&(e.hasUV=!0);break;case"vcount":e.vcount=ie(s.textContent);break;case"p":e.p=ie(s.textContent);break}}return e}function mn(t){const e={};for(let i=0;i<t.length;i++){const n=t[i];e[n.type]===void 0&&(e[n.type]=[]),e[n.type].push(n)}return e}function gn(t){let e=0;for(let i=0,n=t.length;i<n;i++)t[i].hasUV===!0&&e++;e>0&&e<t.length&&(t.uvsNeedsFix=!0)}function ft(t){const e={},i=t.sources,n=t.vertices,s=t.primitives;if(s.length===0)return{};const r=mn(s);for(const a in r){const m=r[a];gn(m),e[a]=bn(m,i,n)}return e}function bn(t,e,i){const n={},s={array:[],stride:0},r={array:[],stride:0},a={array:[],stride:0},m={array:[],stride:0},u={array:[],stride:0},h={array:[],stride:4},N={array:[],stride:4},l=new et,k=[];let y=0;for(let C=0;C<t.length;C++){const T=t[C],oe=T.inputs;let X=0;switch(T.type){case"lines":case"linestrips":X=T.count*2;break;case"triangles":X=T.count*3;break;case"polylist":for(let W=0;W<T.count;W++){const K=T.vcount[W];switch(K){case 3:X+=3;break;case 4:X+=6;break;default:X+=(K-2)*3;break}}break;default:console.warn("THREE.ColladaLoader: Unknown primitive type:",T.type)}l.addGroup(y,X,C),y+=X,T.material&&k.push(T.material);for(const W in oe){const K=oe[W];switch(W){case"VERTEX":for(const Ne in i){const pe=i[Ne];switch(Ne){case"POSITION":const _e=s.array.length;if(ye(T,e[pe],K.offset,s.array),s.stride=e[pe].stride,e.skinWeights&&e.skinIndices&&(ye(T,e.skinIndices,K.offset,h.array),ye(T,e.skinWeights,K.offset,N.array)),T.hasUV===!1&&t.uvsNeedsFix===!0){const zn=(s.array.length-_e)/s.stride;for(let Ct=0;Ct<zn;Ct++)a.array.push(0,0)}break;case"NORMAL":ye(T,e[pe],K.offset,r.array),r.stride=e[pe].stride;break;case"COLOR":ye(T,e[pe],K.offset,u.array),u.stride=e[pe].stride;break;case"TEXCOORD":ye(T,e[pe],K.offset,a.array),a.stride=e[pe].stride;break;case"TEXCOORD1":ye(T,e[pe],K.offset,m.array),a.stride=e[pe].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',Ne)}}break;case"NORMAL":ye(T,e[K.id],K.offset,r.array),r.stride=e[K.id].stride;break;case"COLOR":ye(T,e[K.id],K.offset,u.array,!0),u.stride=e[K.id].stride;break;case"TEXCOORD":ye(T,e[K.id],K.offset,a.array),a.stride=e[K.id].stride;break;case"TEXCOORD1":ye(T,e[K.id],K.offset,m.array),m.stride=e[K.id].stride;break}}}return s.array.length>0&&l.setAttribute("position",new Ae(s.array,s.stride)),r.array.length>0&&l.setAttribute("normal",new Ae(r.array,r.stride)),u.array.length>0&&l.setAttribute("color",new Ae(u.array,u.stride)),a.array.length>0&&l.setAttribute("uv",new Ae(a.array,a.stride)),m.array.length>0&&l.setAttribute("uv1",new Ae(m.array,m.stride)),h.array.length>0&&l.setAttribute("skinIndex",new Ae(h.array,h.stride)),N.array.length>0&&l.setAttribute("skinWeight",new Ae(N.array,N.stride)),n.data=l,n.type=t[0].type,n.materialKeys=k,n}function ye(t,e,i,n,s=!1){const r=t.p,a=t.stride,m=t.vcount;function u(l){let k=r[l+i]*N;const y=k+N;for(;k<y;k++)n.push(h[k]);if(s){const C=n.length-N-1;Me.setRGB(n[C+0],n[C+1],n[C+2],ke),n[C+0]=Me.r,n[C+1]=Me.g,n[C+2]=Me.b}}const h=e.array,N=e.stride;if(t.vcount!==void 0){let l=0;for(let k=0,y=m.length;k<y;k++){const C=m[k];if(C===4){const T=l+a*0,oe=l+a*1,X=l+a*2,W=l+a*3;u(T),u(oe),u(W),u(oe),u(X),u(W)}else if(C===3){const T=l+a*0,oe=l+a*1,X=l+a*2;u(T),u(oe),u(X)}else if(C>4)for(let T=1,oe=C-2;T<=oe;T++){const X=l+a*0,W=l+a*T,K=l+a*(T+1);u(X),u(W),u(K)}l+=a*C}}else for(let l=0,k=r.length;l<k;l+=a)u(l)}function ht(t){return H(V.geometries[t],ft)}function yn(t){const e={name:t.getAttribute("name")||"",joints:{},links:[]};for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];if(n.nodeType===1)switch(n.nodeName){case"technique_common":Nn(n,e);break}}V.kinematicsModels[t.getAttribute("id")]=e}function wn(t){return t.build!==void 0?t.build:t}function kn(t){return H(V.kinematicsModels[t],wn)}function Nn(t,e){for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];if(n.nodeType===1)switch(n.nodeName){case"joint":e.joints[n.getAttribute("sid")]=An(n);break;case"link":e.links.push(pt(n));break}}}function An(t){let e;for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];if(n.nodeType===1)switch(n.nodeName){case"prismatic":case"revolute":e=xn(n);break}}return e}function xn(t){const e={sid:t.getAttribute("sid"),name:t.getAttribute("name")||"",axis:new he,limits:{min:0,max:0},type:t.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];if(n.nodeType===1)switch(n.nodeName){case"axis":const s=M(n.textContent);e.axis.fromArray(s);break;case"limits":const r=n.getElementsByTagName("max")[0],a=n.getElementsByTagName("min")[0];e.limits.max=parseFloat(r.textContent),e.limits.min=parseFloat(a.textContent);break}}return e.limits.min>=e.limits.max&&(e.static=!0),e.middlePosition=(e.limits.min+e.limits.max)/2,e}function pt(t){const e={sid:t.getAttribute("sid"),name:t.getAttribute("name")||"",attachments:[],transforms:[]};for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];if(n.nodeType===1)switch(n.nodeName){case"attachment_full":e.attachments.push(Tn(n));break;case"matrix":case"translate":case"rotate":e.transforms.push(mt(n));break}}return e}function Tn(t){const e={joint:t.getAttribute("joint").split("/").pop(),transforms:[],links:[]};for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];if(n.nodeType===1)switch(n.nodeName){case"link":e.links.push(pt(n));break;case"matrix":case"translate":case"rotate":e.transforms.push(mt(n));break}}return e}function mt(t){const e={type:t.nodeName},i=M(t.textContent);switch(e.type){case"matrix":e.obj=new we,e.obj.fromArray(i).transpose();break;case"translate":e.obj=new he,e.obj.fromArray(i);break;case"rotate":e.obj=new he,e.obj.fromArray(i),e.angle=Fe.degToRad(i[3]);break}return e}function En(t){const e={name:t.getAttribute("name")||"",rigidBodies:{}};for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];if(n.nodeType===1)switch(n.nodeName){case"rigid_body":e.rigidBodies[n.getAttribute("name")]={},Cn(n,e.rigidBodies[n.getAttribute("name")]);break}}V.physicsModels[t.getAttribute("id")]=e}function Cn(t,e){for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];if(n.nodeType===1)switch(n.nodeName){case"technique_common":_n(n,e);break}}}function _n(t,e){for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];if(n.nodeType===1)switch(n.nodeName){case"inertia":e.inertia=M(n.textContent);break;case"mass":e.mass=M(n.textContent)[0];break}}}function Ln(t){const e={bindJointAxis:[]};for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];if(n.nodeType===1)switch(n.nodeName){case"bind_joint_axis":e.bindJointAxis.push(jn(n));break}}V.kinematicsScenes[j(t.getAttribute("url"))]=e}function jn(t){const e={target:t.getAttribute("target").split("/").pop()};for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];if(n.nodeType===1)switch(n.nodeName){case"axis":const s=n.getElementsByTagName("param")[0];e.axis=s.textContent;const r=e.axis.split("inst_").pop().split("axis")[0];e.jointIndex=r.substring(0,r.length-1);break}}return e}function Fn(t){return t.build!==void 0?t.build:t}function Rn(t){return H(V.kinematicsScenes[t],Fn)}function Vn(){const t=Object.keys(V.kinematicsModels)[0],e=Object.keys(V.kinematicsScenes)[0],i=Object.keys(V.visualScenes)[0];if(t===void 0||e===void 0)return;const n=kn(t),s=Rn(e),r=Nt(i),a=s.bindJointAxis,m={};for(let N=0,l=a.length;N<l;N++){const k=a[N],y=le.querySelector('[sid="'+k.target+'"]');if(y){const C=y.parentElement;u(k.jointIndex,C)}}function u(N,l){const k=l.getAttribute("name"),y=n.joints[N];r.traverse(function(C){C.name===k&&(m[N]={object:C,transforms:Mn(l),joint:y,position:y.zeroPosition})})}const h=new we;Et={joints:n&&n.joints,getJointValue:function(N){const l=m[N];if(l)return l.position;console.warn("THREE.ColladaLoader: Joint "+N+" doesn't exist.")},setJointValue:function(N,l){const k=m[N];if(k){const y=k.joint;if(l>y.limits.max||l<y.limits.min)console.warn("THREE.ColladaLoader: Joint "+N+" value "+l+" outside of limits (min: "+y.limits.min+", max: "+y.limits.max+").");else if(y.static)console.warn("THREE.ColladaLoader: Joint "+N+" is static.");else{const C=k.object,T=y.axis,oe=k.transforms;me.identity();for(let X=0;X<oe.length;X++){const W=oe[X];if(W.sid&&W.sid.indexOf(N)!==-1)switch(y.type){case"revolute":me.multiply(h.makeRotationAxis(T,Fe.degToRad(l)));break;case"prismatic":me.multiply(h.makeTranslation(T.x*l,T.y*l,T.z*l));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+y.type);break}else switch(W.type){case"matrix":me.multiply(W.obj);break;case"translate":me.multiply(h.makeTranslation(W.obj.x,W.obj.y,W.obj.z));break;case"scale":me.scale(W.obj);break;case"rotate":me.multiply(h.makeRotationAxis(W.obj,W.angle));break}}C.matrix.copy(me),C.matrix.decompose(C.position,C.quaternion,C.scale),m[N].position=l}}else console.log("THREE.ColladaLoader: "+N+" does not exist.")}}}function Mn(t){const e=[],i=le.querySelector('[id="'+t.id+'"]');for(let n=0;n<i.childNodes.length;n++){const s=i.childNodes[n];if(s.nodeType!==1)continue;let r,a;switch(s.nodeName){case"matrix":r=M(s.textContent);const m=new we().fromArray(r).transpose();e.push({sid:s.getAttribute("sid"),type:s.nodeName,obj:m});break;case"translate":case"scale":r=M(s.textContent),a=new he().fromArray(r),e.push({sid:s.getAttribute("sid"),type:s.nodeName,obj:a});break;case"rotate":r=M(s.textContent),a=new he().fromArray(r);const u=Fe.degToRad(r[3]);e.push({sid:s.getAttribute("sid"),type:s.nodeName,obj:a,angle:u});break}}return e}function vn(t){const e=t.getElementsByTagName("node");for(let i=0;i<e.length;i++){const n=e[i];n.hasAttribute("id")===!1&&n.setAttribute("id",z())}}const me=new we,Ee=new he;function Ke(t){const e={name:t.getAttribute("name")||"",type:t.getAttribute("type"),id:t.getAttribute("id"),sid:t.getAttribute("sid"),matrix:new we,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}};for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];if(n.nodeType!==1)continue;let s;switch(n.nodeName){case"node":e.nodes.push(n.getAttribute("id")),Ke(n);break;case"instance_camera":e.instanceCameras.push(j(n.getAttribute("url")));break;case"instance_controller":e.instanceControllers.push(gt(n));break;case"instance_light":e.instanceLights.push(j(n.getAttribute("url")));break;case"instance_geometry":e.instanceGeometries.push(gt(n));break;case"instance_node":e.instanceNodes.push(j(n.getAttribute("url")));break;case"matrix":s=M(n.textContent),e.matrix.multiply(me.fromArray(s).transpose()),e.transforms[n.getAttribute("sid")]=n.nodeName;break;case"translate":s=M(n.textContent),Ee.fromArray(s),e.matrix.multiply(me.makeTranslation(Ee.x,Ee.y,Ee.z)),e.transforms[n.getAttribute("sid")]=n.nodeName;break;case"rotate":s=M(n.textContent);const r=Fe.degToRad(s[3]);e.matrix.multiply(me.makeRotationAxis(Ee.fromArray(s),r)),e.transforms[n.getAttribute("sid")]=n.nodeName;break;case"scale":s=M(n.textContent),e.matrix.scale(Ee.fromArray(s)),e.transforms[n.getAttribute("sid")]=n.nodeName;break;case"extra":break;default:console.log(n)}}return wt(e.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",e.id):V.nodes[e.id]=e,e}function gt(t){const e={id:j(t.getAttribute("url")),materials:{},skeletons:[]};for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];switch(n.nodeName){case"bind_material":const s=n.getElementsByTagName("instance_material");for(let r=0;r<s.length;r++){const a=s[r],m=a.getAttribute("symbol"),u=a.getAttribute("target");e.materials[m]=j(u)}break;case"skeleton":e.skeletons.push(j(n.textContent));break}}return e}function In(t,e){const i=[],n=[];let s,r,a;for(s=0;s<t.length;s++){const h=t[s];let N;if(wt(h))N=Ce(h),bt(N,e,i);else if(qn(h)){const k=V.visualScenes[h].children;for(let y=0;y<k.length;y++){const C=k[y];if(C.type==="JOINT"){const T=Ce(C.id);bt(T,e,i)}}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",h)}for(s=0;s<e.length;s++)for(r=0;r<i.length;r++)if(a=i[r],a.bone.name===e[s].name){n[s]=a,a.processed=!0;break}for(s=0;s<i.length;s++)a=i[s],a.processed===!1&&(n.push(a),a.processed=!0);const m=[],u=[];for(s=0;s<n.length;s++)a=n[s],m.push(a.bone),u.push(a.boneInverse);return new fi(m,u)}function bt(t,e,i){t.traverse(function(n){if(n.isBone===!0){let s;for(let r=0;r<e.length;r++){const a=e[r];if(a.name===n.name){s=a.boneInverse;break}}s===void 0&&(s=new we),i.push({bone:n,boneInverse:s,processed:!1})}})}function Un(t){const e=[],i=t.matrix,n=t.nodes,s=t.type,r=t.instanceCameras,a=t.instanceControllers,m=t.instanceLights,u=t.instanceGeometries,h=t.instanceNodes;for(let l=0,k=n.length;l<k;l++)e.push(Ce(n[l]));for(let l=0,k=r.length;l<k;l++){const y=an(r[l]);y!==null&&e.push(y.clone())}for(let l=0,k=a.length;l<k;l++){const y=a[l],C=_(y.id),T=ht(C.id),oe=yt(T,y.materials),X=y.skeletons,W=C.skin.joints,K=In(X,W);for(let Ne=0,pe=oe.length;Ne<pe;Ne++){const _e=oe[Ne];_e.isSkinnedMesh&&(_e.bind(K,C.skin.bindMatrix),_e.normalizeSkinWeights()),e.push(_e)}}for(let l=0,k=m.length;l<k;l++){const y=dn(m[l]);y!==null&&e.push(y.clone())}for(let l=0,k=u.length;l<k;l++){const y=u[l],C=ht(y.id),T=yt(C,y.materials);for(let oe=0,X=T.length;oe<X;oe++)e.push(T[oe])}for(let l=0,k=h.length;l<k;l++)e.push(Ce(h[l]).clone());let N;if(n.length===0&&e.length===1)N=e[0];else{N=s==="JOINT"?new ci:new Ft;for(let l=0;l<e.length;l++)N.add(e[l])}return N.name=s==="JOINT"?t.sid:t.name,N.matrix.copy(i),N.matrix.decompose(N.position,N.quaternion,N.scale),N}const Sn=new _t({name:$e.DEFAULT_MATERIAL_NAME,color:16711935});function Dn(t,e){const i=[];for(let n=0,s=t.length;n<s;n++){const r=e[t[n]];r===void 0?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",t[n]),i.push(Sn)):i.push(tn(r))}return i}function yt(t,e){const i=[];for(const n in t){const s=t[n],r=Dn(s.materialKeys,e);if(r.length===0&&(n==="lines"||n==="linestrips"?r.push(new Vt):r.push(new Ve)),n==="lines"||n==="linestrips")for(let h=0,N=r.length;h<N;h++){const l=r[h];if(l.isMeshPhongMaterial===!0||l.isMeshLambertMaterial===!0){const k=new Vt;k.color.copy(l.color),k.opacity=l.opacity,k.transparent=l.transparent,r[h]=k}}const a=s.data.attributes.skinIndex!==void 0,m=r.length===1?r[0]:r;let u;switch(n){case"lines":u=new di(s.data,m);break;case"linestrips":u=new ui(s.data,m);break;case"triangles":case"polylist":a?u=new li(s.data,m):u=new je(s.data,m);break}i.push(u)}return i}function wt(t){return V.nodes[t]!==void 0}function Ce(t){return H(V.nodes[t],Un)}function Pn(t){const e={name:t.getAttribute("name"),children:[]};vn(t);const i=c(t,"node");for(let n=0;n<i.length;n++)e.children.push(Ke(i[n]));V.visualScenes[t.getAttribute("id")]=e}function kt(t){const e=new Ft;e.name=t.name;const i=t.children;for(let n=0;n<i.length;n++){const s=i[n];e.add(Ce(s.id))}return e}function qn(t){return V.visualScenes[t]!==void 0}function Nt(t){return H(V.visualScenes[t],kt)}function Gn(t){const e=c(t,"instance_visual_scene")[0];return Nt(j(e.getAttribute("url")))}function On(){const t=V.clips;if(F(t)===!0){if(F(V.animations)===!1){const e=[];for(const i in V.animations){const n=J(i);for(let s=0,r=n.length;s<r;s++)e.push(n[s])}ve.push(new Lt("default",-1,e))}}else for(const e in t)ve.push(O(e))}function Jn(t){let e="";const i=[t];for(;i.length;){const n=i.shift();n.nodeType===Node.TEXT_NODE?e+=n.textContent:(e+=`
`,i.push(...n.childNodes))}return e.trim()}if(o.length===0)return{scene:new Zn};const At=new DOMParser().parseFromString(o,"application/xml"),le=c(At,"COLLADA")[0],Ye=At.getElementsByTagName("parsererror")[0];if(Ye!==void 0){const t=c(Ye,"div")[0];let e;return t?e=t.textContent:e=Jn(Ye),console.error(`THREE.ColladaLoader: Failed to parse collada file.
`,e),null}const Bn=le.getAttribute("version");console.debug("THREE.ColladaLoader: File version",Bn);const xt=D(c(le,"asset")[0]),Tt=new Gt(this.manager);Tt.setPath(this.resourcePath||b).setCrossOrigin(this.crossOrigin);let Xe;vt&&(Xe=new vt(this.manager),Xe.setPath(this.resourcePath||b));const Me=new tt,ve=[];let Et={},Hn=0;const V={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};Z(le,"library_animations","animation",de),Z(le,"library_animation_clips","animation_clip",d),Z(le,"library_controllers","controller",Q),Z(le,"library_images","image",g),Z(le,"library_effects","effect",be),Z(le,"library_materials","material",$t),Z(le,"library_cameras","camera",nn),Z(le,"library_lights","light",cn),Z(le,"library_geometries","geometry",fn),Z(le,"library_nodes","node",Ke),Z(le,"library_visual_scenes","visual_scene",Pn),Z(le,"library_kinematics_models","kinematics_model",yn),Z(le,"library_physics_models","physics_model",En),Z(le,"scene","instance_kinematics_scene",Ln),se(V.animations,G),se(V.clips,te),se(V.controllers,q),se(V.images,R),se(V.effects,ct),se(V.materials,lt),se(V.cameras,ut),se(V.lights,dt),se(V.geometries,ft),se(V.visualScenes,kt),On(),Vn();const Ie=Gn(c(le,"scene")[0]);return Ie.animations=ve,xt.upAxis==="Z_UP"&&(console.warn("THREE.ColladaLoader: You are loading an asset with a Z-UP coordinate system. The loader just rotates the asset to transform it into Y-UP. The vertex data are not converted, see #24289."),Ie.rotation.set(-Math.PI/2,0,0)),Ie.scale.multiplyScalar(xt.unit),{get animations(){return console.warn("THREE.ColladaLoader: Please access animations over scene.animations now."),ve},kinematics:Et,library:V,scene:Ie}}}const It=new he,Ni=new nt,Oe=new we,xe=new we,Je=new it,Be=new he(1,1,1),He=new he;class ze extends hi{constructor(...o){super(...o),this.urdfNode=null,this.urdfName=""}copy(o,b){return super.copy(o,b),this.urdfNode=o.urdfNode,this.urdfName=o.urdfName,this}}class Ai extends ze{constructor(...o){super(...o),this.isURDFCollider=!0,this.type="URDFCollider"}}class xi extends ze{constructor(...o){super(...o),this.isURDFVisual=!0,this.type="URDFVisual"}}class Ot extends ze{constructor(...o){super(...o),this.isURDFLink=!0,this.type="URDFLink"}}class Jt extends ze{get jointType(){return this._jointType}set jointType(o){if(this.jointType!==o)switch(this._jointType=o,this.matrixWorldNeedsUpdate=!0,o){case"fixed":this.jointValue=[];break;case"continuous":case"revolute":case"prismatic":this.jointValue=new Array(1).fill(0);break;case"planar":this.jointValue=new Array(3).fill(0),this.axis=new he(0,0,1);break;case"floating":this.jointValue=new Array(6).fill(0);break}}get angle(){return this.jointValue[0]}constructor(...o){super(...o),this.isURDFJoint=!0,this.type="URDFJoint",this.jointValue=null,this.jointType="fixed",this.axis=new he(1,0,0),this.limit={lower:0,upper:0},this.ignoreLimits=!1,this.origPosition=null,this.origQuaternion=null,this.mimicJoints=[]}copy(o,b){return super.copy(o,b),this.jointType=o.jointType,this.axis=o.axis.clone(),this.limit.lower=o.limit.lower,this.limit.upper=o.limit.upper,this.ignoreLimits=!1,this.jointValue=[...o.jointValue],this.origPosition=o.origPosition?o.origPosition.clone():null,this.origQuaternion=o.origQuaternion?o.origQuaternion.clone():null,this.mimicJoints=[...o.mimicJoints],this}setJointValue(...o){o=o.map(c=>c===null?null:parseFloat(c)),(!this.origPosition||!this.origQuaternion)&&(this.origPosition=this.position.clone(),this.origQuaternion=this.quaternion.clone());let b=!1;switch(this.mimicJoints.forEach(c=>{b=c.updateFromMimickedJoint(...o)||b}),this.jointType){case"fixed":return b;case"continuous":case"revolute":{let c=o[0];return c==null||c===this.jointValue[0]?b:(!this.ignoreLimits&&this.jointType==="revolute"&&(c=Math.min(this.limit.upper,c),c=Math.max(this.limit.lower,c)),this.quaternion.setFromAxisAngle(this.axis,c).premultiply(this.origQuaternion),this.jointValue[0]!==c?(this.jointValue[0]=c,this.matrixWorldNeedsUpdate=!0,!0):b)}case"prismatic":{let c=o[0];return c==null||c===this.jointValue[0]?b:(this.ignoreLimits||(c=Math.min(this.limit.upper,c),c=Math.max(this.limit.lower,c)),this.position.copy(this.origPosition),It.copy(this.axis).applyEuler(this.rotation),this.position.addScaledVector(It,c),this.jointValue[0]!==c?(this.jointValue[0]=c,this.matrixWorldNeedsUpdate=!0,!0):b)}case"floating":return this.jointValue.every((c,L)=>o[L]===c||o[L]===null)?b:(this.jointValue[0]=o[0]!==null?o[0]:this.jointValue[0],this.jointValue[1]=o[1]!==null?o[1]:this.jointValue[1],this.jointValue[2]=o[2]!==null?o[2]:this.jointValue[2],this.jointValue[3]=o[3]!==null?o[3]:this.jointValue[3],this.jointValue[4]=o[4]!==null?o[4]:this.jointValue[4],this.jointValue[5]=o[5]!==null?o[5]:this.jointValue[5],xe.compose(this.origPosition,this.origQuaternion,Be),Je.setFromEuler(Ni.set(this.jointValue[3],this.jointValue[4],this.jointValue[5],"XYZ")),He.set(this.jointValue[0],this.jointValue[1],this.jointValue[2]),Oe.compose(He,Je,Be),xe.premultiply(Oe),this.position.setFromMatrixPosition(xe),this.rotation.setFromRotationMatrix(xe),this.matrixWorldNeedsUpdate=!0,!0);case"planar":return this.jointValue.every((c,L)=>o[L]===c||o[L]===null)?b:(this.jointValue[0]=o[0]!==null?o[0]:this.jointValue[0],this.jointValue[1]=o[1]!==null?o[1]:this.jointValue[1],this.jointValue[2]=o[2]!==null?o[2]:this.jointValue[2],xe.compose(this.origPosition,this.origQuaternion,Be),Je.setFromAxisAngle(this.axis,this.jointValue[2]),He.set(this.jointValue[0],this.jointValue[1],0),Oe.compose(He,Je,Be),xe.premultiply(Oe),this.position.setFromMatrixPosition(xe),this.rotation.setFromRotationMatrix(xe),this.matrixWorldNeedsUpdate=!0,!0)}return b}}class Ut extends Jt{constructor(...o){super(...o),this.type="URDFMimicJoint",this.mimicJoint=null,this.offset=0,this.multiplier=1}updateFromMimickedJoint(...o){const b=o.map(c=>c*this.multiplier+this.offset);return super.setJointValue(...b)}copy(o,b){return super.copy(o,b),this.mimicJoint=o.mimicJoint,this.offset=o.offset,this.multiplier=o.multiplier,this}}class Ti extends Ot{constructor(...o){super(...o),this.isURDFRobot=!0,this.urdfNode=null,this.urdfRobotNode=null,this.robotName=null,this.links=null,this.joints=null,this.colliders=null,this.visual=null,this.frames=null}copy(o,b){super.copy(o,b),this.urdfRobotNode=o.urdfRobotNode,this.robotName=o.robotName,this.links={},this.joints={},this.colliders={},this.visual={},this.traverse(c=>{c.isURDFJoint&&c.urdfName in o.joints&&(this.joints[c.urdfName]=c),c.isURDFLink&&c.urdfName in o.links&&(this.links[c.urdfName]=c),c.isURDFCollider&&c.urdfName in o.colliders&&(this.colliders[c.urdfName]=c),c.isURDFVisual&&c.urdfName in o.visual&&(this.visual[c.urdfName]=c)});for(const c in this.joints)this.joints[c].mimicJoints=this.joints[c].mimicJoints.map(L=>this.joints[L.name]);return this.frames={...this.colliders,...this.visual,...this.links,...this.joints},this}getFrame(o){return this.frames[o]}setJointValue(o,...b){const c=this.joints[o];return c?c.setJointValue(...b):!1}setJointValues(o){let b=!1;for(const c in o){const L=o[c];Array.isArray(L)?b=this.setJointValue(c,...L)||b:b=this.setJointValue(c,L)||b}return b}}const Qe=new it,St=new nt;function Le(E){return E?E.trim().split(/\s+/g).map(o=>parseFloat(o)):[0,0,0]}function Dt(E,o,b=!1){b||E.rotation.set(0,0,0),St.set(o[0],o[1],o[2],"ZYX"),Qe.setFromEuler(St),Qe.multiply(E.quaternion),E.quaternion.copy(Qe)}class Li{constructor(o){this.manager=o||pi,this.loadMeshCb=this.defaultMeshLoader.bind(this),this.parseVisual=!0,this.parseCollision=!1,this.packages="",this.workingPath="",this.fetchOptions={}}loadAsync(o){return new Promise((b,c)=>{this.load(o,b,null,c)})}load(o,b,c,L){const M=this.manager,ie=qt.extractUrlBase(o),j=this.manager.resolveURL(o);M.itemStart(j),fetch(j,this.fetchOptions).then(z=>{if(z.ok)return c&&c(null),z.text();throw new Error(`URDFLoader: Failed to load url '${j}' with error code ${z.status} : ${z.statusText}.`)}).then(z=>{const F=this.parse(z,this.workingPath||ie);b(F),M.itemEnd(j)}).catch(z=>{L?L(z):console.error("URDFLoader: Error loading file.",z),M.itemError(j),M.itemEnd(j)})}parse(o,b=this.workingPath){const c=this.packages,L=this.loadMeshCb,M=this.parseVisual,ie=this.parseCollision,j=this.manager,z={},F={},D={};function $(P){if(!/^package:\/\//.test(P))return b?b+P:P;const[G,J]=P.replace(/^package:\/\//,"").split(/\/(.+)/);if(typeof c=="string")return c.endsWith(G)?c+"/"+J:c+"/"+G+"/"+J;if(c instanceof Function)return c(G)+"/"+J;if(typeof c=="object")return G in c?c[G]+"/"+J:(console.error(`URDFLoader : ${G} not found in provided package list.`),null)}function ce(P){let G;P instanceof Document?G=[...P.children]:P instanceof Element?G=[P]:G=[...new DOMParser().parseFromString(P,"text/xml").children];const J=G.filter(A=>A.nodeName==="robot").pop();return Z(J)}function Z(P){const G=[...P.children],J=G.filter(x=>x.nodeName.toLowerCase()==="link"),A=G.filter(x=>x.nodeName.toLowerCase()==="joint"),S=G.filter(x=>x.nodeName.toLowerCase()==="material"),U=new Ti;U.robotName=P.getAttribute("name"),U.urdfRobotNode=P,S.forEach(x=>{const w=x.getAttribute("name");D[w]=de(x)});const p={},f={};J.forEach(x=>{const w=x.getAttribute("name"),B=P.querySelector(`child[link="${w}"]`)===null;z[w]=H(x,p,f,B?U:null)}),A.forEach(x=>{const w=x.getAttribute("name");F[w]=se(x)}),U.joints=F,U.links=z,U.colliders=f,U.visual=p;const v=Object.values(F);return v.forEach(x=>{x instanceof Ut&&F[x.mimicJoint].mimicJoints.push(x)}),v.forEach(x=>{const w=new Set,B=ue=>{if(w.has(ue))throw new Error("URDFLoader: Detected an infinite loop of mimic joints.");w.add(ue),ue.mimicJoints.forEach(re=>{B(re)})};B(x)}),U.frames={...f,...p,...z,...F},U}function se(P){const G=[...P.children],J=P.getAttribute("type");let A;const S=G.find(w=>w.nodeName.toLowerCase()==="mimic");S?(A=new Ut,A.mimicJoint=S.getAttribute("joint"),A.multiplier=parseFloat(S.getAttribute("multiplier")||1),A.offset=parseFloat(S.getAttribute("offset")||0)):A=new Jt,A.urdfNode=P,A.name=P.getAttribute("name"),A.urdfName=A.name,A.jointType=J;let U=null,p=null,f=[0,0,0],v=[0,0,0];G.forEach(w=>{const B=w.nodeName.toLowerCase();B==="origin"?(f=Le(w.getAttribute("xyz")),v=Le(w.getAttribute("rpy"))):B==="child"?p=z[w.getAttribute("link")]:B==="parent"?U=z[w.getAttribute("link")]:B==="limit"&&(A.limit.lower=parseFloat(w.getAttribute("lower")||A.limit.lower),A.limit.upper=parseFloat(w.getAttribute("upper")||A.limit.upper))}),U.add(A),A.add(p),Dt(A,v),A.position.set(f[0],f[1],f[2]);const x=G.filter(w=>w.nodeName.toLowerCase()==="axis")[0];if(x){const w=x.getAttribute("xyz").split(/\s+/g).map(B=>parseFloat(B));A.axis=new he(w[0],w[1],w[2]),A.axis.normalize()}return A}function H(P,G,J,A=null){A===null&&(A=new Ot);const S=[...P.children];return A.name=P.getAttribute("name"),A.urdfName=A.name,A.urdfNode=P,M&&S.filter(p=>p.nodeName.toLowerCase()==="visual").forEach(p=>{const f=ge(p,D);if(A.add(f),p.hasAttribute("name")){const v=p.getAttribute("name");f.name=v,f.urdfName=v,G[v]=f}}),ie&&S.filter(p=>p.nodeName.toLowerCase()==="collision").forEach(p=>{const f=ge(p);if(A.add(f),p.hasAttribute("name")){const v=p.getAttribute("name");f.name=v,f.urdfName=v,J[v]=f}}),A}function de(P){const G=[...P.children],J=new Ve;return J.name=P.getAttribute("name")||"",G.forEach(A=>{const S=A.nodeName.toLowerCase();if(S==="color"){const U=A.getAttribute("rgba").split(/\s/g).map(p=>parseFloat(p));J.color.setRGB(U[0],U[1],U[2]),J.opacity=U[3],J.transparent=U[3]<1,J.depthWrite=!J.transparent}else if(S==="texture"){const U=A.getAttribute("filename");if(U){const p=new Gt(j),f=$(U);J.map=p.load(f),J.map.colorSpace=ke}}}),J}function ge(P,G={}){const J=P.nodeName.toLowerCase()==="collision",A=[...P.children];let S=null;const U=A.filter(f=>f.nodeName.toLowerCase()==="material")[0];if(U){const f=U.getAttribute("name");f&&f in G?S=G[f]:S=de(U)}else S=new Ve;const p=J?new Ai:new xi;return p.urdfNode=P,A.forEach(f=>{const v=f.nodeName.toLowerCase();if(v==="geometry"){const x=f.children[0].nodeName.toLowerCase();if(x==="mesh"){const w=f.children[0].getAttribute("filename"),B=$(w);if(B!==null){const ue=f.children[0].getAttribute("scale");if(ue){const re=Le(ue);p.scale.set(re[0],re[1],re[2])}L(B,j,(re,d)=>{d?console.error("URDFLoader: Error loading mesh.",d):re&&(re instanceof je&&(re.material=S),re.position.set(0,0,0),re.quaternion.identity(),p.add(re))})}}else if(x==="box"){const w=new je;w.geometry=new mi(1,1,1),w.material=S;const B=Le(f.children[0].getAttribute("size"));w.scale.set(B[0],B[1],B[2]),p.add(w)}else if(x==="sphere"){const w=new je;w.geometry=new gi(1,30,30),w.material=S;const B=parseFloat(f.children[0].getAttribute("radius"))||0;w.scale.set(B,B,B),p.add(w)}else if(x==="cylinder"){const w=new je;w.geometry=new bi(1,1,1,30),w.material=S;const B=parseFloat(f.children[0].getAttribute("radius"))||0,ue=parseFloat(f.children[0].getAttribute("length"))||0;w.scale.set(B,ue,B),w.rotation.set(Math.PI/2,0,0),p.add(w)}}else if(v==="origin"){const x=Le(f.getAttribute("xyz")),w=Le(f.getAttribute("rpy"));p.position.set(x[0],x[1],x[2]),p.rotation.set(0,0,0),Dt(p,w)}}),p}return ce(o)}defaultMeshLoader(o,b,c){/\.stl$/i.test(o)?new wi(b).load(o,M=>{const ie=new je(M,new Ve);c(ie)}):/\.dae$/i.test(o)?new ki(b).load(o,M=>c(M.scene)):console.warn(`URDFLoader: Could not load model at ${o}.
No loader available`)}}export{ki as C,wi as S,Li as U,_i as a,Ci as s,yi as u};
