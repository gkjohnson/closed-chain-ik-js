import{V as G,W as U,d as W,P as H,S as J,C as N,D,A as $,G as K,g as Q,M as B,J as Z,a as X,L as Y,I as O,b as ee,c as te,e as M}from"./IKRootsHelper-DmBdh0X7.js";import{S as oe,O as ne,T as ie}from"./stats.module-BFsq5STz.js";import{G as R}from"./Goal-DJOimEJ_.js";import{s as T,U as ae,S as se,C as re,u as de,a as le}from"./URDFLoader-Dz40SxeK.js";const n={animate:"gyrate",baseTilt:0,solve:!0,displayMesh:!0,displayIk:!1,enableControls:!0,settleIterations:6,displayConvergedOnly:!0},pe={maxIterations:10,divergeThreshold:.05,stallThreshold:1e-5,translationErrorClamp:.01,rotationErrorClamp:.01,translationConvergeThreshold:1e-5,rotationConvergeThreshold:1e-5};let g,E,A,f,y,k,v,l,e,h,b=!0;const q=new G;let r,a,I,x,P,j,c;ce();F();function ce(){E=new oe,document.body.appendChild(E.dom),A=document.getElementById("output"),f=new U({antialias:!0}),f.setPixelRatio(window.devicePixelRatio),f.setSize(window.innerWidth,window.innerHeight),f.shadowMap.enabled=!0,f.shadowMap.type=W,document.body.appendChild(f.domElement),k=new H(50,window.innerWidth/window.innerHeight,.01,100),k.position.set(.3,.3,.3),y=new J,y.background=new N(1971741),h=new D,h.position.set(1,3,2),h.intensity=3*.75,h.castShadow=!0,h.shadow.mapSize.setScalar(2048);const o=h.shadow.camera;o.top=o.right=.25,o.left=o.bottom=-.25,o.near=0,o.far=10,o.updateProjectionMatrix();const m=new D;m.intensity=3*.25,m.position.set(-1,-3,-2);const S=new $(2038302,3);y.add(h,h.target,m,S),v=new ne(k,f.domElement),v.target.y=.05,v.update(),l=new ie(k,f.domElement),l.setSpace("local"),y.add(l.getHelper()),l.addEventListener("mouseDown",()=>{v.enabled=!1,n.animate="none"}),l.addEventListener("mouseUp",()=>{v.enabled=!0,b=!0,T(a,r),a.updateMatrixWorld(!0)}),e=new K,y.add(e),l.attach(e),l.addEventListener("objectChange",()=>{b=!0}),g=new Q,g.add(n,"enableControls"),g.add(n,"animate",["none","gyrate","rotate"]).listen(),g.add(n,"baseTilt",-.3,.3,1e-4).onChange(()=>b=!0),g.add(n,"solve"),g.add(n,"displayMesh"),g.add(n,"displayIk"),g.add(n,"displayConvergedOnly"),g.add(n,"settleIterations",1,20,1).onChange(()=>b=!0);const C=new ae;C.fetchOptions={mode:"cors"},C.packages={pi_hexapod_description:"https://raw.githubusercontent.com/PI-PhysikInstrumente/PI_ROS_Driver/master/pi_hexapod_driver/pi_hexapod_description/"},C.loadMeshCb=(p,s,t)=>{/\.stl$/.test(p)?new se(s).load(p,i=>{const u=new B(i);u.castShadow=!0,u.receiveShadow=!0,t(u)}):/\.dae$/.test(p)&&new re(s).load(p,i=>{const u=i.scene,d=[];u.traverse(w=>{w.castShadow=!0,w.receiveShadow=!0,w.isLight&&d.push(w)}),d.forEach(w=>{w.parent.remove(w)}),t(u)})},C.loadAsync("https://raw.githubusercontent.com/gkjohnson/PI_ROS_Driver/master/pi_hexapod_driver/pi_hexapod_description/urdf/pi_hexapod.urdf").then(p=>{r=p,r.traverse(t=>{t.jointType==="floating"&&(t.jointType="fixed")});const s=r.joints;for(const t in s){const i=s[t];i.name.includes("ang")?(i.limit.lower=-1/0,i.limit.upper=1/0):i.name.includes("cart")?(i.limit.lower*=5,i.limit.upper*=5):i.jointType==="revolute"&&(i.jointType="continuous")}a=de(r),a.setDoF(),r.rotation.set(-Math.PI/2,0,0),a.setEuler(-Math.PI/2,0,0);for(let t=0;t<6;t++){const i=`axis${t}_platform_anchor_joint_x`;r.joints[i].setJointValue(Math.PI)}T(a,r),j=a.find(t=>t.name==="platform_link"),c=new R,c.setEuler(-Math.PI/2,0,0),c.setPosition(0,.095,0),c.makeClosure(j),e.quaternion.set(...c.quaternion),e.position.set(...c.position);for(let t=0;t<6;t++){const i=`axis${t}_base_anchor_link_3`,u=a.find(L=>L.name===i),d=new Z;d.setDoF(X.Z),d.setMinLimits(.035),d.setMaxLimits(.08),u.addChild(d);const w=new Y;d.addChild(w);const _=new R;_.setPosition(0,0,.05),_.setEuler(Math.PI,0,0),w.addChild(_);const z=`axis${t}_platform_anchor_link_3`,V=a.find(L=>L.name===z);_.makeClosure(V)}I=new O([a,c]),I.setColor(15277667),I.setJointScale(.05),x=new O([a,c]),x.setColor(15277667),x.setDrawThrough(!0),x.setJointScale(.05),P=new ee([a,c]),y.add(r,I,x),y.add(r)}),window.addEventListener("resize",()=>{const p=window.innerWidth,s=window.innerHeight,t=p/s;f.setSize(p,s),k.aspect=t,k.updateProjectionMatrix()}),window.addEventListener("keydown",p=>{switch(p.key){case"w":l.setMode("translate");break;case"e":l.setMode("rotate");break;case"q":l.setSpace(l.space==="local"?"world":"local");break;case"f":v.target.set(0,.05,0),v.update();break}})}function he(){c.setPosition(e.position.x,e.position.y,e.position.z),c.setQuaternion(e.quaternion.x,e.quaternion.y,e.quaternion.z,e.quaternion.w);let o="",m=0;T(a,r);let S=!1;for(let C=0;C<n.settleIterations;C++){a.updateMatrixWorld(!0),Object.assign(P,pe);const p=window.performance.now(),s=P.solve(),t=window.performance.now()-p;m+=t,o+=t.toFixed(2)+"ms "+te[s[0]]+`
`,S=s.filter(d=>d===M.CONVERGED).length===s.length;const i=s.filter(d=>d===M.DIVERGED).length===s.length,u=s.filter(d=>d===M.STALLED).length===s.length;if(S||i||u)break}o=o+`
Total: `+m.toFixed(2)+"ms",A.textContent=o,(!n.displayConvergedOnly||S)&&le(r,a)}function F(){if(requestAnimationFrame(F),a&&!l.dragging){e.matrix.set(...j.matrixWorld).transpose(),e.matrix.decompose(e.position,e.quaternion,e.scale);const o=e.position,m=e.quaternion;c.setPosition(o.x,o.y,o.z),c.setQuaternion(m.x,m.y,m.z,m.w)}if(r){if(a.setEuler(-Math.PI/2,0,n.baseTilt),n.animate==="gyrate"){const o=window.performance.now()*.004;e.position.z=Math.cos(o)*.02,e.position.x=Math.sin(o)*.02,e.position.y=.1025,e.rotation.set(-Math.PI/2,0,0),b=!0}else if(n.animate==="rotate"){const o=window.performance.now()*.004;e.position.set(0,.105+Math.sin(o)*.0075,0),e.rotation.set(-Math.PI/2,0,Math.cos(o*1)*.75),b=!0}b&&n.solve&&(he(),b=!1),r.visible=n.displayMesh,I.visible=n.displayIk,x.visible=n.displayIk,q.subVectors(h.position,h.target.position),h.target.position.copy(r.position),h.position.copy(r.position).add(q)}l.visible=n.enableControls,l.enabled=n.enableControls,f.render(y,k),E.update()}
