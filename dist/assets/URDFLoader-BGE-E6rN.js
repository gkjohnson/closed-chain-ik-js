import{$ as nt,a as fe,J as Ue,L as Se,aX as Wn,aY as Kn,ad as $e,ae as Pt,u as et,C as tt,af as ke,l as Ze,V as he,X as Ae,aZ as Yn,aD as Xn,ak as Ot,o as we,k as _t,S as Zn,ao as qt,x as Re,aO as Lt,a_ as Qn,ab as Ve,am as De,h as $n,q as ei,F as ti,P as jt,aN as ni,A as ii,ax as si,ay as oi,D as ri,G as Ft,Q as it,aT as Rt,aV as ai,a1 as ci,K as Vt,a2 as li,M as Fe,Z as ui,ai as di,a0 as fi,al as Pe,aK as vt,O as hi,an as pi,U as mi,j as gi,N as bi}from"./IKRootsHelper-COUPCDCE.js";const Oe=new Float64Array(3),qe=new Float64Array(3),Le=new nt;function yi(N,o=!1,y=!0){let c=null,j,R=!0,Z=null;if(y&&(Z={},N.traverse(_=>{_.isURDFJoint&&(Z[_.name]={ignoreLimits:_.ignoreLimits,values:[..._.jointValue]},_.ignoreLimits=!0,_.setJointValue(0,0,0,0,0,0))}),N.updateMatrixWorld(!0)),N.isURDFRobot)c=new Ue,c.name="__world_joint__",c.setDoF(fe.X,fe.Y,fe.Z,fe.EX,fe.EY,fe.EZ),j=new Se,j.name=N.name,c.addChild(j);else if(N.isURDFLink)j=new Se,j.name=N.name,R=!o;else if(N.isURDFJoint){c=new Ue;const _=N.jointType;switch(_){case"continuous":case"revolute":case"prismatic":{const U=new Se;c.addChild(U);const C=new Ue;C.name=N.name,U.addChild(C);const ie=new Se;C.addChild(ie);const oe=new Ue;ie.addChild(oe),Oe[0]=0,Oe[1]=0,Oe[2]=1,qe[0]=N.axis.x,qe[1]=N.axis.y,qe[2]=N.axis.z,Wn(C.quaternion,Oe,qe),Kn(oe.quaternion,C.quaternion),C.setMatrixNeedsUpdate(),oe.setMatrixNeedsUpdate(),_==="revolute"||_==="continuous"?C.setDoF(fe.EZ):C.setDoF(fe.Z),_!=="continuous"&&(C.setMinLimits(N.limit.lower),C.setMaxLimits(N.limit.upper)),j=oe;break}case"fixed":{j=c,R=!o;break}default:console.error(`urdfRobotToIKRoot: Joint type ${_} not supported.`),R=!o}}else return null;(c||j).setPosition(N.position.x,N.position.y,N.position.z),(c||j).setQuaternion(N.quaternion.x,N.quaternion.y,N.quaternion.z,N.quaternion.w);const S=N.children;for(let _=0,U=S.length;_<U;_++){const C=yi(S[_],o,!1);C&&(j.addChild(C),R=!0)}return y&&(N.traverse(_=>{if(_.isURDFJoint){const{values:U,ignoreLimits:C}=Z[_.name];_.setJointValue(...U),_.ignoreLimits=C}}),N.updateMatrixWorld(!0)),!o||R?c||j:null}function Ci(N,o){Le.copy(o.rotation),Le.reorder("ZYX");const[y,c,j]=Le,[R,Z,S]=N.position;N.setDoFValue(fe.X,o.position.x-R),N.setDoFValue(fe.Y,o.position.y-Z),N.setDoFValue(fe.Z,o.position.z-S),N.setDoFValue(fe.EX,Le.x-y),N.setDoFValue(fe.EY,Le.y-c),N.setDoFValue(fe.EZ,Le.z-j),N.traverse(_=>{if(_.isJoint){const U=_.name;U in o.joints&&_.setDoFValues(o.joints[U].angle)}})}function _i(N,o){o.updateMatrixWorld(),N.matrix.set(...o.matrixWorld).transpose(),N.matrix.decompose(N.position,N.quaternion,N.scale),o.traverse(y=>{if(y.isJoint){const c=y,j=N.joints[y.name];j&&(j.jointType==="prismatic"?j.setJointValue(c.getDoFValue(fe.Z)):j.setJointValue(c.getDoFValue(fe.EZ)))}})}class wi extends $e{constructor(o){super(o)}load(o,y,c,j){const R=this,Z=new Pt(this.manager);Z.setPath(this.path),Z.setResponseType("arraybuffer"),Z.setRequestHeader(this.requestHeader),Z.setWithCredentials(this.withCredentials),Z.load(o,function(S){try{y(R.parse(S))}catch(_){j?j(_):console.error(_),R.manager.itemError(o)}},c,j)}parse(o){function y(U){const C=new DataView(U),ie=32/8*3+32/8*3*3+16/8,oe=C.getUint32(80,!0);if(80+32/8+oe*ie===C.byteLength)return!0;const se=[115,111,108,105,100];for(let H=0;H<5;H++)if(c(se,C,H))return!1;return!0}function c(U,C,ie){for(let oe=0,Q=U.length;oe<Q;oe++)if(U[oe]!==C.getUint8(ie+oe))return!1;return!0}function j(U){const C=new DataView(U),ie=C.getUint32(80,!0);let oe,Q,se,H=!1,de,ge,O,G,z;for(let T=0;T<70;T++)C.getUint32(T,!1)==1129270351&&C.getUint8(T+4)==82&&C.getUint8(T+5)==61&&(H=!0,de=new Float32Array(ie*3*3),ge=C.getUint8(T+6)/255,O=C.getUint8(T+7)/255,G=C.getUint8(T+8)/255,z=C.getUint8(T+9)/255);const x=84,P=50,D=new et,p=new Float32Array(ie*3*3),f=new Float32Array(ie*3*3),M=new tt;for(let T=0;T<ie;T++){const w=x+T*P,B=C.getFloat32(w,!0),ue=C.getFloat32(w+4,!0),ae=C.getFloat32(w+8,!0);if(H){const d=C.getUint16(w+48,!0);(d&32768)===0?(oe=(d&31)/31,Q=(d>>5&31)/31,se=(d>>10&31)/31):(oe=ge,Q=O,se=G)}for(let d=1;d<=3;d++){const te=w+d*12,J=T*3*3+(d-1)*3;p[J]=C.getFloat32(te,!0),p[J+1]=C.getFloat32(te+4,!0),p[J+2]=C.getFloat32(te+8,!0),f[J]=B,f[J+1]=ue,f[J+2]=ae,H&&(M.setRGB(oe,Q,se,ke),de[J]=M.r,de[J+1]=M.g,de[J+2]=M.b)}}return D.setAttribute("position",new Ze(p,3)),D.setAttribute("normal",new Ze(f,3)),H&&(D.setAttribute("color",new Ze(de,3)),D.hasColors=!0,D.alpha=z),D}function R(U){const C=new et,ie=/solid([\s\S]*?)endsolid/g,oe=/facet([\s\S]*?)endfacet/g,Q=/solid\s(.+)/;let se=0;const H=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,de=new RegExp("vertex"+H+H+H,"g"),ge=new RegExp("normal"+H+H+H,"g"),O=[],G=[],z=[],x=new he;let P,D=0,p=0,f=0;for(;(P=ie.exec(U))!==null;){p=f;const M=P[0],T=(P=Q.exec(M))!==null?P[1]:"";for(z.push(T);(P=oe.exec(M))!==null;){let ue=0,ae=0;const d=P[0];for(;(P=ge.exec(d))!==null;)x.x=parseFloat(P[1]),x.y=parseFloat(P[2]),x.z=parseFloat(P[3]),ae++;for(;(P=de.exec(d))!==null;)O.push(parseFloat(P[1]),parseFloat(P[2]),parseFloat(P[3])),G.push(x.x,x.y,x.z),ue++,f++;ae!==1&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+se),ue!==3&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+se),se++}const w=p,B=f-p;C.userData.groupNames=z,C.addGroup(w,B,D),D++}return C.setAttribute("position",new Ae(O,3)),C.setAttribute("normal",new Ae(G,3)),C}function Z(U){return typeof U!="string"?new TextDecoder().decode(U):U}function S(U){if(typeof U=="string"){const C=new Uint8Array(U.length);for(let ie=0;ie<U.length;ie++)C[ie]=U.charCodeAt(ie)&255;return C.buffer||C}else return U}const _=S(o);return y(_)?j(_):R(Z(o))}}class Mt extends Yn{constructor(o){super(o)}parse(o){function y(d){switch(d.image_type){case oe:case H:if(d.colormap_length>256||d.colormap_size!==24||d.colormap_type!==1)throw new Error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case Q:case se:case de:case ge:if(d.colormap_type)throw new Error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case ie:throw new Error("THREE.TGALoader: No data.");default:throw new Error("THREE.TGALoader: Invalid type "+d.image_type)}if(d.width<=0||d.height<=0)throw new Error("THREE.TGALoader: Invalid image size.");if(d.pixel_size!==8&&d.pixel_size!==16&&d.pixel_size!==24&&d.pixel_size!==32)throw new Error("THREE.TGALoader: Invalid pixel size "+d.pixel_size)}function c(d,te,J,$,ce){let Y,ee;const q=J.pixel_size>>3,I=J.width*J.height*q;if(te&&(ee=ce.subarray($,$+=J.colormap_length*(J.colormap_size>>3))),d){Y=new Uint8Array(I);let F,g,V,ne=0;const be=new Uint8Array(q);for(;ne<I;)if(F=ce[$++],g=(F&127)+1,F&128){for(V=0;V<q;++V)be[V]=ce[$++];for(V=0;V<g;++V)Y.set(be,ne+V*q);ne+=q*g}else{for(g*=q,V=0;V<g;++V)Y[ne+V]=ce[$++];ne+=g}}else Y=ce.subarray($,$+=te?J.width*J.height:I);return{pixel_data:Y,palettes:ee}}function j(d,te,J,$,ce,Y,ee,q,I){const F=I;let g,V=0,ne,be;const Te=M.width;for(be=te;be!==$;be+=J)for(ne=ce;ne!==ee;ne+=Y,V++)g=q[V],d[(ne+Te*be)*4+3]=255,d[(ne+Te*be)*4+2]=F[g*3+0],d[(ne+Te*be)*4+1]=F[g*3+1],d[(ne+Te*be)*4+0]=F[g*3+2];return d}function R(d,te,J,$,ce,Y,ee,q){let I,F=0,g,V;const ne=M.width;for(V=te;V!==$;V+=J)for(g=ce;g!==ee;g+=Y,F+=2)I=q[F+0]+(q[F+1]<<8),d[(g+ne*V)*4+0]=(I&31744)>>7,d[(g+ne*V)*4+1]=(I&992)>>2,d[(g+ne*V)*4+2]=(I&31)<<3,d[(g+ne*V)*4+3]=I&32768?0:255;return d}function Z(d,te,J,$,ce,Y,ee,q){let I=0,F,g;const V=M.width;for(g=te;g!==$;g+=J)for(F=ce;F!==ee;F+=Y,I+=3)d[(F+V*g)*4+3]=255,d[(F+V*g)*4+2]=q[I+0],d[(F+V*g)*4+1]=q[I+1],d[(F+V*g)*4+0]=q[I+2];return d}function S(d,te,J,$,ce,Y,ee,q){let I=0,F,g;const V=M.width;for(g=te;g!==$;g+=J)for(F=ce;F!==ee;F+=Y,I+=4)d[(F+V*g)*4+2]=q[I+0],d[(F+V*g)*4+1]=q[I+1],d[(F+V*g)*4+0]=q[I+2],d[(F+V*g)*4+3]=q[I+3];return d}function _(d,te,J,$,ce,Y,ee,q){let I,F=0,g,V;const ne=M.width;for(V=te;V!==$;V+=J)for(g=ce;g!==ee;g+=Y,F++)I=q[F],d[(g+ne*V)*4+0]=I,d[(g+ne*V)*4+1]=I,d[(g+ne*V)*4+2]=I,d[(g+ne*V)*4+3]=255;return d}function U(d,te,J,$,ce,Y,ee,q){let I=0,F,g;const V=M.width;for(g=te;g!==$;g+=J)for(F=ce;F!==ee;F+=Y,I+=2)d[(F+V*g)*4+0]=q[I+0],d[(F+V*g)*4+1]=q[I+0],d[(F+V*g)*4+2]=q[I+0],d[(F+V*g)*4+3]=q[I+1];return d}function C(d,te,J,$,ce){let Y,ee,q,I,F,g;switch((M.flags&O)>>G){default:case P:Y=0,q=1,F=te,ee=0,I=1,g=J;break;case z:Y=0,q=1,F=te,ee=J-1,I=-1,g=-1;break;case D:Y=te-1,q=-1,F=-1,ee=0,I=1,g=J;break;case x:Y=te-1,q=-1,F=-1,ee=J-1,I=-1,g=-1;break}if(B)switch(M.pixel_size){case 8:_(d,ee,I,g,Y,q,F,$);break;case 16:U(d,ee,I,g,Y,q,F,$);break;default:throw new Error("THREE.TGALoader: Format not supported.")}else switch(M.pixel_size){case 8:j(d,ee,I,g,Y,q,F,$,ce);break;case 16:R(d,ee,I,g,Y,q,F,$);break;case 24:Z(d,ee,I,g,Y,q,F,$);break;case 32:S(d,ee,I,g,Y,q,F,$);break;default:throw new Error("THREE.TGALoader: Format not supported.")}return d}const ie=0,oe=1,Q=2,se=3,H=9,de=10,ge=11,O=48,G=4,z=0,x=1,P=2,D=3;if(o.length<19)throw new Error("THREE.TGALoader: Not enough data to contain header.");let p=0;const f=new Uint8Array(o),M={id_length:f[p++],colormap_type:f[p++],image_type:f[p++],colormap_index:f[p++]|f[p++]<<8,colormap_length:f[p++]|f[p++]<<8,colormap_size:f[p++],origin:[f[p++]|f[p++]<<8,f[p++]|f[p++]<<8],width:f[p++]|f[p++]<<8,height:f[p++]|f[p++]<<8,pixel_size:f[p++],flags:f[p++]};if(y(M),M.id_length+p>o.length)throw new Error("THREE.TGALoader: No data.");p+=M.id_length;let T=!1,w=!1,B=!1;switch(M.image_type){case H:T=!0,w=!0;break;case oe:w=!0;break;case de:T=!0;break;case Q:break;case ge:T=!0,B=!0;break;case se:B=!0;break}const ue=new Uint8Array(M.width*M.height*4),ae=c(T,w,M,p,f);return C(ue,M.width,M.height,ae.pixel_data,ae.palettes),{data:ue,width:M.width,height:M.height,flipY:!0,generateMipmaps:!0,minFilter:Xn}}}class ki extends $e{load(o,y,c,j){const R=this,Z=R.path===""?Ot.extractUrlBase(o):R.path,S=new Pt(R.manager);S.setPath(R.path),S.setRequestHeader(R.requestHeader),S.setWithCredentials(R.withCredentials),S.load(o,function(_){try{y(R.parse(_,Z))}catch(U){j?j(U):console.error(U),R.manager.itemError(o)}},c,j)}parse(o,y){function c(t,e){const i=[],n=t.childNodes;for(let s=0,r=n.length;s<r;s++){const a=n[s];a.nodeName===e&&i.push(a)}return i}function j(t){if(t.length===0)return[];const e=t.trim().split(/\s+/),i=new Array(e.length);for(let n=0,s=e.length;n<s;n++)i[n]=e[n];return i}function R(t){if(t.length===0)return[];const e=t.trim().split(/\s+/),i=new Array(e.length);for(let n=0,s=e.length;n<s;n++)i[n]=parseFloat(e[n]);return i}function Z(t){if(t.length===0)return[];const e=t.trim().split(/\s+/),i=new Array(e.length);for(let n=0,s=e.length;n<s;n++)i[n]=parseInt(e[n]);return i}function S(t){return t.substring(1)}function _(){return"three_default_"+Bn++}function U(t){return Object.keys(t).length===0}function C(t){return{unit:ie(c(t,"unit")[0]),upAxis:oe(c(t,"up_axis")[0])}}function ie(t){return t!==void 0&&t.hasAttribute("meter")===!0?parseFloat(t.getAttribute("meter")):1}function oe(t){return t!==void 0?t.textContent:"Y_UP"}function Q(t,e,i,n){const s=c(t,e)[0];if(s!==void 0){const r=c(s,i);for(let a=0;a<r.length;a++)n(r[a])}}function se(t,e){for(const i in t){const n=t[i];n.build=e(t[i])}}function H(t,e){return t.build!==void 0||(t.build=e(t)),t.build}function de(t){const e={sources:{},samplers:{},channels:{}};let i=!1;for(let n=0,s=t.childNodes.length;n<s;n++){const r=t.childNodes[n];if(r.nodeType!==1)continue;let a;switch(r.nodeName){case"source":a=r.getAttribute("id"),e.sources[a]=We(r);break;case"sampler":a=r.getAttribute("id"),e.samplers[a]=ge(r);break;case"channel":a=r.getAttribute("target"),e.channels[a]=O(r);break;case"animation":de(r),i=!0;break;default:console.log(r)}}i===!1&&(v.animations[t.getAttribute("id")||Re.generateUUID()]=e)}function ge(t){const e={inputs:{}};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1&&s.nodeName==="input"){const r=S(s.getAttribute("source")),a=s.getAttribute("semantic");e.inputs[a]=r}}return e}function O(t){const e={};let n=t.getAttribute("target").split("/");const s=n.shift();let r=n.shift();const a=r.indexOf("(")!==-1,m=r.indexOf(".")!==-1;if(m)n=r.split("."),r=n.shift(),e.member=n.shift();else if(a){const u=r.split("(");r=u.shift();for(let h=0;h<u.length;h++)u[h]=parseInt(u[h].replace(/\)/,""));e.indices=u}return e.id=s,e.sid=r,e.arraySyntax=a,e.memberSyntax=m,e.sampler=S(t.getAttribute("source")),e}function G(t){const e=[],i=t.channels,n=t.samplers,s=t.sources;for(const r in i)if(i.hasOwnProperty(r)){const a=i[r],m=n[a.sampler],u=m.inputs.INPUT,h=m.inputs.OUTPUT,A=s[u],l=s[h],k=x(a,A,l);M(k,e)}return e}function z(t){return H(v.animations[t],G)}function x(t,e,i){const n=v.nodes[t.id],s=Ce(n.id),r=n.transforms[t.sid],a=n.matrix.clone().transpose();let m,u,h,A,l,k;const b={};switch(r){case"matrix":for(h=0,A=e.array.length;h<A;h++)if(m=e.array[h],u=h*i.stride,b[m]===void 0&&(b[m]={}),t.arraySyntax===!0){const re=i.array[u],X=t.indices[0]+4*t.indices[1];b[m][X]=re}else for(l=0,k=i.stride;l<k;l++)b[m][l]=i.array[u+l];break;case"translate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',r);break;case"rotate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',r);break;case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',r);break}const L=P(b,a);return{name:s.uuid,keyframes:L}}function P(t,e){const i=[];for(const s in t)i.push({time:parseFloat(s),value:t[s]});i.sort(n);for(let s=0;s<16;s++)T(i,s,e.elements[s]);return i;function n(s,r){return s.time-r.time}}const D=new he,p=new he,f=new it;function M(t,e){const i=t.keyframes,n=t.name,s=[],r=[],a=[],m=[];for(let u=0,h=i.length;u<h;u++){const A=i[u],l=A.time,k=A.value;me.fromArray(k).transpose(),me.decompose(D,f,p),s.push(l),r.push(D.x,D.y,D.z),a.push(f.x,f.y,f.z,f.w),m.push(p.x,p.y,p.z)}return r.length>0&&e.push(new Rt(n+".position",s,r)),a.length>0&&e.push(new ai(n+".quaternion",s,a)),m.length>0&&e.push(new Rt(n+".scale",s,m)),e}function T(t,e,i){let n,s=!0,r,a;for(r=0,a=t.length;r<a;r++)n=t[r],n.value[e]===void 0?n.value[e]=null:s=!1;if(s===!0)for(r=0,a=t.length;r<a;r++)n=t[r],n.value[e]=i;else w(t,e)}function w(t,e){let i,n;for(let s=0,r=t.length;s<r;s++){const a=t[s];if(a.value[e]===null){if(i=B(t,s,e),n=ue(t,s,e),i===null){a.value[e]=n.value[e];continue}if(n===null){a.value[e]=i.value[e];continue}ae(a,i,n,e)}}}function B(t,e,i){for(;e>=0;){const n=t[e];if(n.value[i]!==null)return n;e--}return null}function ue(t,e,i){for(;e<t.length;){const n=t[e];if(n.value[i]!==null)return n;e++}return null}function ae(t,e,i,n){if(i.time-e.time===0){t.value[n]=e.value[n];return}t.value[n]=(t.time-e.time)*(i.value[n]-e.value[n])/(i.time-e.time)+e.value[n]}function d(t){const e={name:t.getAttribute("id")||"default",start:parseFloat(t.getAttribute("start")||0),end:parseFloat(t.getAttribute("end")||0),animations:[]};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];s.nodeType===1&&s.nodeName==="instance_animation"&&e.animations.push(S(s.getAttribute("url")))}v.clips[t.getAttribute("id")]=e}function te(t){const e=[],i=t.name,n=t.end-t.start||-1,s=t.animations;for(let r=0,a=s.length;r<a;r++){const m=z(s[r]);for(let u=0,h=m.length;u<h;u++)e.push(m[u])}return new Lt(i,n,e)}function J(t){return H(v.clips[t],te)}function $(t){const e={};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"skin":e.id=S(s.getAttribute("source")),e.skin=ce(s);break;case"morph":e.id=S(s.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.");break}}v.controllers[t.getAttribute("id")]=e}function ce(t){const e={sources:{}};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"bind_shape_matrix":e.bindShapeMatrix=R(s.textContent);break;case"source":const r=s.getAttribute("id");e.sources[r]=We(s);break;case"joints":e.joints=Y(s);break;case"vertex_weights":e.vertexWeights=ee(s);break}}return e}function Y(t){const e={inputs:{}};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1&&s.nodeName==="input"){const r=s.getAttribute("semantic"),a=S(s.getAttribute("source"));e.inputs[r]=a}}return e}function ee(t){const e={inputs:{}};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"input":const r=s.getAttribute("semantic"),a=S(s.getAttribute("source")),m=parseInt(s.getAttribute("offset"));e.inputs[r]={id:a,offset:m};break;case"vcount":e.vcount=Z(s.textContent);break;case"v":e.v=Z(s.textContent);break}}return e}function q(t){const e={id:t.id},i=v.geometries[e.id];return t.skin!==void 0&&(e.skin=I(t.skin),i.sources.skinIndices=e.skin.indices,i.sources.skinWeights=e.skin.weights),e}function I(t){const i={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},n=t.sources,s=t.vertexWeights,r=s.vcount,a=s.v,m=s.inputs.JOINT.offset,u=s.inputs.WEIGHT.offset,h=t.sources[t.joints.inputs.JOINT],A=t.sources[t.joints.inputs.INV_BIND_MATRIX],l=n[s.inputs.WEIGHT.id].array;let k=0,b,L,E;for(b=0,E=r.length;b<E;b++){const X=r[b],W=[];for(L=0;L<X;L++){const K=a[k+m],Ne=a[k+u],pe=l[Ne];W.push({index:K,weight:pe}),k+=2}for(W.sort(re),L=0;L<4;L++){const K=W[L];K!==void 0?(i.indices.array.push(K.index),i.weights.array.push(K.weight)):(i.indices.array.push(0),i.weights.array.push(0))}}for(t.bindShapeMatrix?i.bindMatrix=new we().fromArray(t.bindShapeMatrix).transpose():i.bindMatrix=new we().identity(),b=0,E=h.array.length;b<E;b++){const X=h.array[b],W=new we().fromArray(A.array,b*A.stride).transpose();i.joints.push({name:X,boneInverse:W})}return i;function re(X,W){return W.weight-X.weight}}function F(t){return H(v.controllers[t],q)}function g(t){const e={init_from:c(t,"init_from")[0].textContent};v.images[t.getAttribute("id")]=e}function V(t){return t.build!==void 0?t.build:t.init_from}function ne(t){const e=v.images[t];return e!==void 0?H(e,V):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",t),null)}function be(t){const e={};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];s.nodeType===1&&s.nodeName==="profile_COMMON"&&(e.profile=Te(s))}v.effects[t.getAttribute("id")]=e}function Te(t){const e={surfaces:{},samplers:{}};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"newparam":zt(s,e);break;case"technique":e.technique=Wt(s);break;case"extra":e.extra=rt(s);break}}return e}function zt(t,e){const i=t.getAttribute("sid");for(let n=0,s=t.childNodes.length;n<s;n++){const r=t.childNodes[n];if(r.nodeType===1)switch(r.nodeName){case"surface":e.surfaces[i]=Bt(r);break;case"sampler2D":e.samplers[i]=Ht(r);break}}}function Bt(t){const e={};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];s.nodeType===1&&s.nodeName==="init_from"&&(e.init_from=s.textContent)}return e}function Ht(t){const e={};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];s.nodeType===1&&s.nodeName==="source"&&(e.source=s.textContent)}return e}function Wt(t){const e={};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"constant":case"lambert":case"blinn":case"phong":e.type=s.nodeName,e.parameters=Kt(s);break;case"extra":e.extra=rt(s);break}}return e}function Kt(t){const e={};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":e[s.nodeName]=st(s);break;case"transparent":e[s.nodeName]={opaque:s.hasAttribute("opaque")?s.getAttribute("opaque"):"A_ONE",data:st(s)};break}}return e}function st(t){const e={};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"color":e[s.nodeName]=R(s.textContent);break;case"float":e[s.nodeName]=parseFloat(s.textContent);break;case"texture":e[s.nodeName]={id:s.getAttribute("texture"),extra:ot(s)};break}}return e}function ot(t){const e={technique:{}};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];s.nodeType===1&&s.nodeName==="extra"&&Yt(s,e)}return e}function Yt(t,e){for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];s.nodeType===1&&s.nodeName==="technique"&&Xt(s,e)}}function Xt(t,e){for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":e.technique[s.nodeName]=parseFloat(s.textContent);break;case"wrapU":case"wrapV":s.textContent.toUpperCase()==="TRUE"?e.technique[s.nodeName]=1:s.textContent.toUpperCase()==="FALSE"?e.technique[s.nodeName]=0:e.technique[s.nodeName]=parseInt(s.textContent);break;case"bump":e[s.nodeName]=at(s);break}}}function rt(t){const e={};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];s.nodeType===1&&s.nodeName==="technique"&&(e.technique=Zt(s))}return e}function Zt(t){const e={};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"double_sided":e[s.nodeName]=parseInt(s.textContent);break;case"bump":e[s.nodeName]=at(s);break}}return e}function at(t){const e={};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];s.nodeType===1&&s.nodeName==="texture"&&(e[s.nodeName]={id:s.getAttribute("texture"),texcoord:s.getAttribute("texcoord"),extra:ot(s)})}return e}function ct(t){return t}function Qt(t){return H(v.effects[t],ct)}function $t(t){const e={name:t.getAttribute("name")};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];s.nodeType===1&&s.nodeName==="instance_effect"&&(e.url=S(s.getAttribute("url")))}v.materials[t.getAttribute("id")]=e}function en(t){let e,i=t.slice((t.lastIndexOf(".")-1>>>0)+2);return i=i.toLowerCase(),i==="tga"?e=Xe:e=Tt,e}function lt(t){const e=Qt(t.url),i=e.profile.technique;let n;switch(i.type){case"phong":case"blinn":n=new Ve;break;case"lambert":n=new Qn;break;default:n=new _t;break}n.name=t.name||"";function s(u,h=null){const A=e.profile.samplers[u.id];let l=null;if(A!==void 0){const k=e.profile.surfaces[A.source];l=ne(k.init_from)}else console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),l=ne(u.id);if(l!==null){const k=en(l);if(k!==void 0){const b=k.load(l),L=u.extra;if(L!==void 0&&L.technique!==void 0&&U(L.technique)===!1){const E=L.technique;b.wrapS=E.wrapU?Pe:vt,b.wrapT=E.wrapV?Pe:vt,b.offset.set(E.offsetU||0,E.offsetV||0),b.repeat.set(E.repeatU||1,E.repeatV||1)}else b.wrapS=Pe,b.wrapT=Pe;return h!==null&&(b.colorSpace=h),b}else return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",l),null}else return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",u.id),null}const r=i.parameters;for(const u in r){const h=r[u];switch(u){case"diffuse":h.color&&n.color.fromArray(h.color),h.texture&&(n.map=s(h.texture,ke));break;case"specular":h.color&&n.specular&&n.specular.fromArray(h.color),h.texture&&(n.specularMap=s(h.texture));break;case"bump":h.texture&&(n.normalMap=s(h.texture));break;case"ambient":h.texture&&(n.lightMap=s(h.texture,ke));break;case"shininess":h.float&&n.shininess&&(n.shininess=h.float);break;case"emission":h.color&&n.emissive&&n.emissive.fromArray(h.color),h.texture&&(n.emissiveMap=s(h.texture,ke));break}}De.colorSpaceToWorking(n.color,ke),n.specular&&De.colorSpaceToWorking(n.specular,ke),n.emissive&&De.colorSpaceToWorking(n.emissive,ke);let a=r.transparent,m=r.transparency;if(m===void 0&&a&&(m={float:1}),a===void 0&&m&&(a={opaque:"A_ONE",data:{color:[1,1,1,1]}}),a&&m)if(a.data.texture)n.transparent=!0;else{const u=a.data.color;switch(a.opaque){case"A_ONE":n.opacity=u[3]*m.float;break;case"RGB_ZERO":n.opacity=1-u[0]*m.float;break;case"A_ZERO":n.opacity=1-u[3]*m.float;break;case"RGB_ONE":n.opacity=u[0]*m.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',a.opaque)}n.opacity<1&&(n.transparent=!0)}if(i.extra!==void 0&&i.extra.technique!==void 0){const u=i.extra.technique;for(const h in u){const A=u[h];switch(h){case"double_sided":n.side=A===1?ei:ti;break;case"bump":n.normalMap=s(A.texture),n.normalScale=new $n(1,1);break}}}return n}function tn(t){return H(v.materials[t],lt)}function nn(t){const e={name:t.getAttribute("name")};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];s.nodeType===1&&s.nodeName==="optics"&&(e.optics=sn(s))}v.cameras[t.getAttribute("id")]=e}function sn(t){for(let e=0;e<t.childNodes.length;e++){const i=t.childNodes[e];if(i.nodeName==="technique_common")return on(i)}return{}}function on(t){const e={};for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];switch(n.nodeName){case"perspective":case"orthographic":e.technique=n.nodeName,e.parameters=rn(n);break}}return e}function rn(t){const e={};for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];switch(n.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":e[n.nodeName]=parseFloat(n.textContent);break}}return e}function ut(t){let e;switch(t.optics.technique){case"perspective":e=new jt(t.optics.parameters.yfov,t.optics.parameters.aspect_ratio,t.optics.parameters.znear,t.optics.parameters.zfar);break;case"orthographic":let i=t.optics.parameters.ymag,n=t.optics.parameters.xmag;const s=t.optics.parameters.aspect_ratio;n=n===void 0?i*s:n,i=i===void 0?n/s:i,n*=.5,i*=.5,e=new ni(-n,n,i,-i,t.optics.parameters.znear,t.optics.parameters.zfar);break;default:e=new jt;break}return e.name=t.name||"",e}function an(t){const e=v.cameras[t];return e!==void 0?H(e,ut):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",t),null)}function cn(t){let e={};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];s.nodeType===1&&s.nodeName==="technique_common"&&(e=ln(s))}v.lights[t.getAttribute("id")]=e}function ln(t){const e={};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"directional":case"point":case"spot":case"ambient":e.technique=s.nodeName,e.parameters=un(s)}}return e}function un(t){const e={};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"color":const r=R(s.textContent);e.color=new tt().fromArray(r),De.colorSpaceToWorking(e.color,ke);break;case"falloff_angle":e.falloffAngle=parseFloat(s.textContent);break;case"quadratic_attenuation":const a=parseFloat(s.textContent);e.distance=a?Math.sqrt(1/a):0;break}}return e}function dt(t){let e;switch(t.technique){case"directional":e=new ri;break;case"point":e=new oi;break;case"spot":e=new si;break;case"ambient":e=new ii;break}return t.parameters.color&&e.color.copy(t.parameters.color),t.parameters.distance&&(e.distance=t.parameters.distance),e}function dn(t){const e=v.lights[t];return e!==void 0?H(e,dt):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",t),null)}function fn(t){const e={name:t.getAttribute("name"),sources:{},vertices:{},primitives:[]},i=c(t,"mesh")[0];if(i!==void 0){for(let n=0;n<i.childNodes.length;n++){const s=i.childNodes[n];if(s.nodeType!==1)continue;const r=s.getAttribute("id");switch(s.nodeName){case"source":e.sources[r]=We(s);break;case"vertices":e.vertices=hn(s);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",s.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":e.primitives.push(pn(s));break;default:console.log(s)}}v.geometries[t.getAttribute("id")]=e}}function We(t){const e={array:[],stride:3};for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];if(n.nodeType===1)switch(n.nodeName){case"float_array":e.array=R(n.textContent);break;case"Name_array":e.array=j(n.textContent);break;case"technique_common":const s=c(n,"accessor")[0];s!==void 0&&(e.stride=parseInt(s.getAttribute("stride")));break}}return e}function hn(t){const e={};for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];n.nodeType===1&&(e[n.getAttribute("semantic")]=S(n.getAttribute("source")))}return e}function pn(t){const e={type:t.nodeName,material:t.getAttribute("material"),count:parseInt(t.getAttribute("count")),inputs:{},stride:0,hasUV:!1};for(let i=0,n=t.childNodes.length;i<n;i++){const s=t.childNodes[i];if(s.nodeType===1)switch(s.nodeName){case"input":const r=S(s.getAttribute("source")),a=s.getAttribute("semantic"),m=parseInt(s.getAttribute("offset")),u=parseInt(s.getAttribute("set")),h=u>0?a+u:a;e.inputs[h]={id:r,offset:m},e.stride=Math.max(e.stride,m+1),a==="TEXCOORD"&&(e.hasUV=!0);break;case"vcount":e.vcount=Z(s.textContent);break;case"p":e.p=Z(s.textContent);break}}return e}function mn(t){const e={};for(let i=0;i<t.length;i++){const n=t[i];e[n.type]===void 0&&(e[n.type]=[]),e[n.type].push(n)}return e}function gn(t){let e=0;for(let i=0,n=t.length;i<n;i++)t[i].hasUV===!0&&e++;e>0&&e<t.length&&(t.uvsNeedsFix=!0)}function ft(t){const e={},i=t.sources,n=t.vertices,s=t.primitives;if(s.length===0)return{};const r=mn(s);for(const a in r){const m=r[a];gn(m),e[a]=bn(m,i,n)}return e}function bn(t,e,i){const n={},s={array:[],stride:0},r={array:[],stride:0},a={array:[],stride:0},m={array:[],stride:0},u={array:[],stride:0},h={array:[],stride:4},A={array:[],stride:4},l=new et,k=[];let b=0;for(let L=0;L<t.length;L++){const E=t[L],re=E.inputs;let X=0;switch(E.type){case"lines":case"linestrips":X=E.count*2;break;case"triangles":X=E.count*3;break;case"polylist":for(let W=0;W<E.count;W++){const K=E.vcount[W];switch(K){case 3:X+=3;break;case 4:X+=6;break;default:X+=(K-2)*3;break}}break;default:console.warn("THREE.ColladaLoader: Unknown primitive type:",E.type)}l.addGroup(b,X,L),b+=X,E.material&&k.push(E.material);for(const W in re){const K=re[W];switch(W){case"VERTEX":for(const Ne in i){const pe=i[Ne];switch(Ne){case"POSITION":const _e=s.array.length;if(ye(E,e[pe],K.offset,s.array),s.stride=e[pe].stride,e.skinWeights&&e.skinIndices&&(ye(E,e.skinIndices,K.offset,h.array),ye(E,e.skinWeights,K.offset,A.array)),E.hasUV===!1&&t.uvsNeedsFix===!0){const Hn=(s.array.length-_e)/s.stride;for(let Ct=0;Ct<Hn;Ct++)a.array.push(0,0)}break;case"NORMAL":ye(E,e[pe],K.offset,r.array),r.stride=e[pe].stride;break;case"COLOR":ye(E,e[pe],K.offset,u.array),u.stride=e[pe].stride;break;case"TEXCOORD":ye(E,e[pe],K.offset,a.array),a.stride=e[pe].stride;break;case"TEXCOORD1":ye(E,e[pe],K.offset,m.array),a.stride=e[pe].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',Ne)}}break;case"NORMAL":ye(E,e[K.id],K.offset,r.array),r.stride=e[K.id].stride;break;case"COLOR":ye(E,e[K.id],K.offset,u.array,!0),u.stride=e[K.id].stride;break;case"TEXCOORD":ye(E,e[K.id],K.offset,a.array),a.stride=e[K.id].stride;break;case"TEXCOORD1":ye(E,e[K.id],K.offset,m.array),m.stride=e[K.id].stride;break}}}return s.array.length>0&&l.setAttribute("position",new Ae(s.array,s.stride)),r.array.length>0&&l.setAttribute("normal",new Ae(r.array,r.stride)),u.array.length>0&&l.setAttribute("color",new Ae(u.array,u.stride)),a.array.length>0&&l.setAttribute("uv",new Ae(a.array,a.stride)),m.array.length>0&&l.setAttribute("uv1",new Ae(m.array,m.stride)),h.array.length>0&&l.setAttribute("skinIndex",new Ae(h.array,h.stride)),A.array.length>0&&l.setAttribute("skinWeight",new Ae(A.array,A.stride)),n.data=l,n.type=t[0].type,n.materialKeys=k,n}function ye(t,e,i,n,s=!1){const r=t.p,a=t.stride,m=t.vcount;function u(l){let k=r[l+i]*A;const b=k+A;for(;k<b;k++)n.push(h[k]);if(s){const L=n.length-A-1;ve.setRGB(n[L+0],n[L+1],n[L+2],ke),n[L+0]=ve.r,n[L+1]=ve.g,n[L+2]=ve.b}}const h=e.array,A=e.stride;if(t.vcount!==void 0){let l=0;for(let k=0,b=m.length;k<b;k++){const L=m[k];if(L===4){const E=l+a*0,re=l+a*1,X=l+a*2,W=l+a*3;u(E),u(re),u(W),u(re),u(X),u(W)}else if(L===3){const E=l+a*0,re=l+a*1,X=l+a*2;u(E),u(re),u(X)}else if(L>4)for(let E=1,re=L-2;E<=re;E++){const X=l+a*0,W=l+a*E,K=l+a*(E+1);u(X),u(W),u(K)}l+=a*L}}else for(let l=0,k=r.length;l<k;l+=a)u(l)}function ht(t){return H(v.geometries[t],ft)}function yn(t){const e={name:t.getAttribute("name")||"",joints:{},links:[]};for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];n.nodeType===1&&n.nodeName==="technique_common"&&Nn(n,e)}v.kinematicsModels[t.getAttribute("id")]=e}function wn(t){return t.build!==void 0?t.build:t}function kn(t){return H(v.kinematicsModels[t],wn)}function Nn(t,e){for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];if(n.nodeType===1)switch(n.nodeName){case"joint":e.joints[n.getAttribute("sid")]=An(n);break;case"link":e.links.push(pt(n));break}}}function An(t){let e;for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];if(n.nodeType===1)switch(n.nodeName){case"prismatic":case"revolute":e=xn(n);break}}return e}function xn(t){const e={sid:t.getAttribute("sid"),name:t.getAttribute("name")||"",axis:new he,limits:{min:0,max:0},type:t.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];if(n.nodeType===1)switch(n.nodeName){case"axis":const s=R(n.textContent);e.axis.fromArray(s);break;case"limits":const r=n.getElementsByTagName("max")[0],a=n.getElementsByTagName("min")[0];e.limits.max=parseFloat(r.textContent),e.limits.min=parseFloat(a.textContent);break}}return e.limits.min>=e.limits.max&&(e.static=!0),e.middlePosition=(e.limits.min+e.limits.max)/2,e}function pt(t){const e={sid:t.getAttribute("sid"),name:t.getAttribute("name")||"",attachments:[],transforms:[]};for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];if(n.nodeType===1)switch(n.nodeName){case"attachment_full":e.attachments.push(Tn(n));break;case"matrix":case"translate":case"rotate":e.transforms.push(mt(n));break}}return e}function Tn(t){const e={joint:t.getAttribute("joint").split("/").pop(),transforms:[],links:[]};for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];if(n.nodeType===1)switch(n.nodeName){case"link":e.links.push(pt(n));break;case"matrix":case"translate":case"rotate":e.transforms.push(mt(n));break}}return e}function mt(t){const e={type:t.nodeName},i=R(t.textContent);switch(e.type){case"matrix":e.obj=new we,e.obj.fromArray(i).transpose();break;case"translate":e.obj=new he,e.obj.fromArray(i);break;case"rotate":e.obj=new he,e.obj.fromArray(i),e.angle=Re.degToRad(i[3]);break}return e}function En(t){const e={name:t.getAttribute("name")||"",rigidBodies:{}};for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];n.nodeType===1&&n.nodeName==="rigid_body"&&(e.rigidBodies[n.getAttribute("name")]={},Cn(n,e.rigidBodies[n.getAttribute("name")]))}v.physicsModels[t.getAttribute("id")]=e}function Cn(t,e){for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];n.nodeType===1&&n.nodeName==="technique_common"&&_n(n,e)}}function _n(t,e){for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];if(n.nodeType===1)switch(n.nodeName){case"inertia":e.inertia=R(n.textContent);break;case"mass":e.mass=R(n.textContent)[0];break}}}function Ln(t){const e={bindJointAxis:[]};for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];n.nodeType===1&&n.nodeName==="bind_joint_axis"&&e.bindJointAxis.push(jn(n))}v.kinematicsScenes[S(t.getAttribute("url"))]=e}function jn(t){const e={target:t.getAttribute("target").split("/").pop()};for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];if(n.nodeType===1&&n.nodeName==="axis"){const s=n.getElementsByTagName("param")[0];e.axis=s.textContent;const r=e.axis.split("inst_").pop().split("axis")[0];e.jointIndex=r.substring(0,r.length-1)}}return e}function Fn(t){return t.build!==void 0?t.build:t}function Rn(t){return H(v.kinematicsScenes[t],Fn)}function Vn(){const t=Object.keys(v.kinematicsModels)[0],e=Object.keys(v.kinematicsScenes)[0],i=Object.keys(v.visualScenes)[0];if(t===void 0||e===void 0)return;const n=kn(t),s=Rn(e),r=Nt(i),a=s.bindJointAxis,m={};for(let A=0,l=a.length;A<l;A++){const k=a[A],b=le.querySelector('[sid="'+k.target+'"]');if(b){const L=b.parentElement;u(k.jointIndex,L)}}function u(A,l){const k=l.getAttribute("name"),b=n.joints[A];r.traverse(function(L){L.name===k&&(m[A]={object:L,transforms:vn(l),joint:b,position:b.zeroPosition})})}const h=new we;Et={joints:n&&n.joints,getJointValue:function(A){const l=m[A];if(l)return l.position;console.warn("THREE.ColladaLoader: Joint "+A+" doesn't exist.")},setJointValue:function(A,l){const k=m[A];if(k){const b=k.joint;if(l>b.limits.max||l<b.limits.min)console.warn("THREE.ColladaLoader: Joint "+A+" value "+l+" outside of limits (min: "+b.limits.min+", max: "+b.limits.max+").");else if(b.static)console.warn("THREE.ColladaLoader: Joint "+A+" is static.");else{const L=k.object,E=b.axis,re=k.transforms;me.identity();for(let X=0;X<re.length;X++){const W=re[X];if(W.sid&&W.sid.indexOf(A)!==-1)switch(b.type){case"revolute":me.multiply(h.makeRotationAxis(E,Re.degToRad(l)));break;case"prismatic":me.multiply(h.makeTranslation(E.x*l,E.y*l,E.z*l));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+b.type);break}else switch(W.type){case"matrix":me.multiply(W.obj);break;case"translate":me.multiply(h.makeTranslation(W.obj.x,W.obj.y,W.obj.z));break;case"scale":me.scale(W.obj);break;case"rotate":me.multiply(h.makeRotationAxis(W.obj,W.angle));break}}L.matrix.copy(me),L.matrix.decompose(L.position,L.quaternion,L.scale),m[A].position=l}}else console.log("THREE.ColladaLoader: "+A+" does not exist.")}}}function vn(t){const e=[],i=le.querySelector('[id="'+t.id+'"]');for(let n=0;n<i.childNodes.length;n++){const s=i.childNodes[n];if(s.nodeType!==1)continue;let r,a;switch(s.nodeName){case"matrix":r=R(s.textContent);const m=new we().fromArray(r).transpose();e.push({sid:s.getAttribute("sid"),type:s.nodeName,obj:m});break;case"translate":case"scale":r=R(s.textContent),a=new he().fromArray(r),e.push({sid:s.getAttribute("sid"),type:s.nodeName,obj:a});break;case"rotate":r=R(s.textContent),a=new he().fromArray(r);const u=Re.degToRad(r[3]);e.push({sid:s.getAttribute("sid"),type:s.nodeName,obj:a,angle:u});break}}return e}function Mn(t){const e=t.getElementsByTagName("node");for(let i=0;i<e.length;i++){const n=e[i];n.hasAttribute("id")===!1&&n.setAttribute("id",_())}}const me=new we,Ee=new he;function Ke(t){const e={name:t.getAttribute("name")||"",type:t.getAttribute("type"),id:t.getAttribute("id"),sid:t.getAttribute("sid"),matrix:new we,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}};for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];if(n.nodeType!==1)continue;let s;switch(n.nodeName){case"node":e.nodes.push(n.getAttribute("id")),Ke(n);break;case"instance_camera":e.instanceCameras.push(S(n.getAttribute("url")));break;case"instance_controller":e.instanceControllers.push(gt(n));break;case"instance_light":e.instanceLights.push(S(n.getAttribute("url")));break;case"instance_geometry":e.instanceGeometries.push(gt(n));break;case"instance_node":e.instanceNodes.push(S(n.getAttribute("url")));break;case"matrix":s=R(n.textContent),e.matrix.multiply(me.fromArray(s).transpose()),e.transforms[n.getAttribute("sid")]=n.nodeName;break;case"translate":s=R(n.textContent),Ee.fromArray(s),e.matrix.multiply(me.makeTranslation(Ee.x,Ee.y,Ee.z)),e.transforms[n.getAttribute("sid")]=n.nodeName;break;case"rotate":s=R(n.textContent);const r=Re.degToRad(s[3]);e.matrix.multiply(me.makeRotationAxis(Ee.fromArray(s),r)),e.transforms[n.getAttribute("sid")]=n.nodeName;break;case"scale":s=R(n.textContent),e.matrix.scale(Ee.fromArray(s)),e.transforms[n.getAttribute("sid")]=n.nodeName;break;case"extra":break;default:console.log(n)}}return wt(e.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",e.id):v.nodes[e.id]=e,e}function gt(t){const e={id:S(t.getAttribute("url")),materials:{},skeletons:[]};for(let i=0;i<t.childNodes.length;i++){const n=t.childNodes[i];switch(n.nodeName){case"bind_material":const s=n.getElementsByTagName("instance_material");for(let r=0;r<s.length;r++){const a=s[r],m=a.getAttribute("symbol"),u=a.getAttribute("target");e.materials[m]=S(u)}break;case"skeleton":e.skeletons.push(S(n.textContent));break}}return e}function In(t,e){const i=[],n=[];let s,r,a;for(s=0;s<t.length;s++){const h=t[s];let A;if(wt(h))A=Ce(h),bt(A,e,i);else if(On(h)){const k=v.visualScenes[h].children;for(let b=0;b<k.length;b++){const L=k[b];if(L.type==="JOINT"){const E=Ce(L.id);bt(E,e,i)}}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",h)}for(s=0;s<e.length;s++)for(r=0;r<i.length;r++)if(a=i[r],a.bone.name===e[s].name){n[s]=a,a.processed=!0;break}for(s=0;s<i.length;s++)a=i[s],a.processed===!1&&(n.push(a),a.processed=!0);const m=[],u=[];for(s=0;s<n.length;s++)a=n[s],m.push(a.bone),u.push(a.boneInverse);return new fi(m,u)}function bt(t,e,i){t.traverse(function(n){if(n.isBone===!0){let s;for(let r=0;r<e.length;r++){const a=e[r];if(a.name===n.name){s=a.boneInverse;break}}s===void 0&&(s=new we),i.push({bone:n,boneInverse:s,processed:!1})}})}function Un(t){const e=[],i=t.matrix,n=t.nodes,s=t.type,r=t.instanceCameras,a=t.instanceControllers,m=t.instanceLights,u=t.instanceGeometries,h=t.instanceNodes;for(let l=0,k=n.length;l<k;l++)e.push(Ce(n[l]));for(let l=0,k=r.length;l<k;l++){const b=an(r[l]);b!==null&&e.push(b.clone())}for(let l=0,k=a.length;l<k;l++){const b=a[l],L=F(b.id),E=ht(L.id),re=yt(E,b.materials),X=b.skeletons,W=L.skin.joints,K=In(X,W);for(let Ne=0,pe=re.length;Ne<pe;Ne++){const _e=re[Ne];_e.isSkinnedMesh&&(_e.bind(K,L.skin.bindMatrix),_e.normalizeSkinWeights()),e.push(_e)}}for(let l=0,k=m.length;l<k;l++){const b=dn(m[l]);b!==null&&e.push(b.clone())}for(let l=0,k=u.length;l<k;l++){const b=u[l],L=ht(b.id),E=yt(L,b.materials);for(let re=0,X=E.length;re<X;re++)e.push(E[re])}for(let l=0,k=h.length;l<k;l++)e.push(Ce(h[l]).clone());let A;if(n.length===0&&e.length===1)A=e[0];else{A=s==="JOINT"?new ci:new Ft;for(let l=0;l<e.length;l++)A.add(e[l])}return A.name=s==="JOINT"?t.sid:t.name,A.matrix.copy(i),A.matrix.decompose(A.position,A.quaternion,A.scale),A}const Sn=new _t({name:$e.DEFAULT_MATERIAL_NAME,color:16711935});function Dn(t,e){const i=[];for(let n=0,s=t.length;n<s;n++){const r=e[t[n]];r===void 0?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",t[n]),i.push(Sn)):i.push(tn(r))}return i}function yt(t,e){const i=[];for(const n in t){const s=t[n],r=Dn(s.materialKeys,e);if(r.length===0&&(n==="lines"||n==="linestrips"?r.push(new Vt):r.push(new Ve)),n==="lines"||n==="linestrips")for(let h=0,A=r.length;h<A;h++){const l=r[h];if(l.isMeshPhongMaterial===!0||l.isMeshLambertMaterial===!0){const k=new Vt;k.color.copy(l.color),k.opacity=l.opacity,k.transparent=l.transparent,r[h]=k}}const a=s.data.attributes.skinIndex!==void 0,m=r.length===1?r[0]:r;let u;switch(n){case"lines":u=new di(s.data,m);break;case"linestrips":u=new ui(s.data,m);break;case"triangles":case"polylist":a?u=new li(s.data,m):u=new Fe(s.data,m);break}i.push(u)}return i}function wt(t){return v.nodes[t]!==void 0}function Ce(t){return H(v.nodes[t],Un)}function Pn(t){const e={name:t.getAttribute("name"),children:[]};Mn(t);const i=c(t,"node");for(let n=0;n<i.length;n++)e.children.push(Ke(i[n]));v.visualScenes[t.getAttribute("id")]=e}function kt(t){const e=new Ft;e.name=t.name;const i=t.children;for(let n=0;n<i.length;n++){const s=i[n];e.add(Ce(s.id))}return e}function On(t){return v.visualScenes[t]!==void 0}function Nt(t){return H(v.visualScenes[t],kt)}function qn(t){const e=c(t,"instance_visual_scene")[0];return Nt(S(e.getAttribute("url")))}function Gn(){const t=v.clips;if(U(t)===!0){if(U(v.animations)===!1){const e=[];for(const i in v.animations){const n=z(i);for(let s=0,r=n.length;s<r;s++)e.push(n[s])}Me.push(new Lt("default",-1,e))}}else for(const e in t)Me.push(J(e))}function Jn(t){let e="";const i=[t];for(;i.length;){const n=i.shift();n.nodeType===Node.TEXT_NODE?e+=n.textContent:(e+=`
`,i.push(...n.childNodes))}return e.trim()}if(o.length===0)return{scene:new Zn};const At=new DOMParser().parseFromString(o,"application/xml"),le=c(At,"COLLADA")[0],Ye=At.getElementsByTagName("parsererror")[0];if(Ye!==void 0){const t=c(Ye,"div")[0];let e;return t?e=t.textContent:e=Jn(Ye),console.error(`THREE.ColladaLoader: Failed to parse collada file.
`,e),null}const zn=le.getAttribute("version");console.debug("THREE.ColladaLoader: File version",zn);const xt=C(c(le,"asset")[0]),Tt=new qt(this.manager);Tt.setPath(this.resourcePath||y).setCrossOrigin(this.crossOrigin);let Xe;Mt&&(Xe=new Mt(this.manager),Xe.setPath(this.resourcePath||y));const ve=new tt,Me=[];let Et={},Bn=0;const v={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};Q(le,"library_animations","animation",de),Q(le,"library_animation_clips","animation_clip",d),Q(le,"library_controllers","controller",$),Q(le,"library_images","image",g),Q(le,"library_effects","effect",be),Q(le,"library_materials","material",$t),Q(le,"library_cameras","camera",nn),Q(le,"library_lights","light",cn),Q(le,"library_geometries","geometry",fn),Q(le,"library_nodes","node",Ke),Q(le,"library_visual_scenes","visual_scene",Pn),Q(le,"library_kinematics_models","kinematics_model",yn),Q(le,"library_physics_models","physics_model",En),Q(le,"scene","instance_kinematics_scene",Ln),se(v.animations,G),se(v.clips,te),se(v.controllers,q),se(v.images,V),se(v.effects,ct),se(v.materials,lt),se(v.cameras,ut),se(v.lights,dt),se(v.geometries,ft),se(v.visualScenes,kt),Gn(),Vn();const Ie=qn(c(le,"scene")[0]);return Ie.animations=Me,xt.upAxis==="Z_UP"&&(console.warn("THREE.ColladaLoader: You are loading an asset with a Z-UP coordinate system. The loader just rotates the asset to transform it into Y-UP. The vertex data are not converted, see #24289."),Ie.rotation.set(-Math.PI/2,0,0)),Ie.scale.multiplyScalar(xt.unit),{get animations(){return console.warn("THREE.ColladaLoader: Please access animations over scene.animations now."),Me},kinematics:Et,library:v,scene:Ie}}}const It=new he,Ni=new nt,Ge=new we,xe=new we,Je=new it,ze=new he(1,1,1),Be=new he;class He extends hi{constructor(...o){super(...o),this.urdfNode=null,this.urdfName=""}copy(o,y){return super.copy(o,y),this.urdfNode=o.urdfNode,this.urdfName=o.urdfName,this}}class Ai extends He{constructor(...o){super(...o),this.isURDFCollider=!0,this.type="URDFCollider"}}class xi extends He{constructor(...o){super(...o),this.isURDFVisual=!0,this.type="URDFVisual"}}class Gt extends He{constructor(...o){super(...o),this.isURDFLink=!0,this.type="URDFLink"}}class Jt extends He{get jointType(){return this._jointType}set jointType(o){if(this.jointType!==o)switch(this._jointType=o,this.matrixWorldNeedsUpdate=!0,o){case"fixed":this.jointValue=[];break;case"continuous":case"revolute":case"prismatic":this.jointValue=new Array(1).fill(0);break;case"planar":this.jointValue=new Array(3).fill(0),this.axis=new he(0,0,1);break;case"floating":this.jointValue=new Array(6).fill(0);break}}get angle(){return this.jointValue[0]}constructor(...o){super(...o),this.isURDFJoint=!0,this.type="URDFJoint",this.jointValue=null,this.jointType="fixed",this.axis=new he(1,0,0),this.limit={lower:0,upper:0},this.ignoreLimits=!1,this.origPosition=null,this.origQuaternion=null,this.mimicJoints=[]}copy(o,y){return super.copy(o,y),this.jointType=o.jointType,this.axis=o.axis.clone(),this.limit.lower=o.limit.lower,this.limit.upper=o.limit.upper,this.ignoreLimits=!1,this.jointValue=[...o.jointValue],this.origPosition=o.origPosition?o.origPosition.clone():null,this.origQuaternion=o.origQuaternion?o.origQuaternion.clone():null,this.mimicJoints=[...o.mimicJoints],this}setJointValue(...o){o=o.map(c=>c===null?null:parseFloat(c)),(!this.origPosition||!this.origQuaternion)&&(this.origPosition=this.position.clone(),this.origQuaternion=this.quaternion.clone());let y=!1;switch(this.mimicJoints.forEach(c=>{y=c.updateFromMimickedJoint(...o)||y}),this.jointType){case"fixed":return y;case"continuous":case"revolute":{let c=o[0];return c==null||c===this.jointValue[0]?y:(!this.ignoreLimits&&this.jointType==="revolute"&&(c=Math.min(this.limit.upper,c),c=Math.max(this.limit.lower,c)),this.quaternion.setFromAxisAngle(this.axis,c).premultiply(this.origQuaternion),this.jointValue[0]!==c?(this.jointValue[0]=c,this.matrixWorldNeedsUpdate=!0,!0):y)}case"prismatic":{let c=o[0];return c==null||c===this.jointValue[0]?y:(this.ignoreLimits||(c=Math.min(this.limit.upper,c),c=Math.max(this.limit.lower,c)),this.position.copy(this.origPosition),It.copy(this.axis).applyEuler(this.rotation),this.position.addScaledVector(It,c),this.jointValue[0]!==c?(this.jointValue[0]=c,this.matrixWorldNeedsUpdate=!0,!0):y)}case"floating":return this.jointValue.every((c,j)=>o[j]===c||o[j]===null)?y:(this.jointValue[0]=o[0]!==null?o[0]:this.jointValue[0],this.jointValue[1]=o[1]!==null?o[1]:this.jointValue[1],this.jointValue[2]=o[2]!==null?o[2]:this.jointValue[2],this.jointValue[3]=o[3]!==null?o[3]:this.jointValue[3],this.jointValue[4]=o[4]!==null?o[4]:this.jointValue[4],this.jointValue[5]=o[5]!==null?o[5]:this.jointValue[5],xe.compose(this.origPosition,this.origQuaternion,ze),Je.setFromEuler(Ni.set(this.jointValue[3],this.jointValue[4],this.jointValue[5],"XYZ")),Be.set(this.jointValue[0],this.jointValue[1],this.jointValue[2]),Ge.compose(Be,Je,ze),xe.premultiply(Ge),this.position.setFromMatrixPosition(xe),this.rotation.setFromRotationMatrix(xe),this.matrixWorldNeedsUpdate=!0,!0);case"planar":return this.jointValue.every((c,j)=>o[j]===c||o[j]===null)?y:(this.jointValue[0]=o[0]!==null?o[0]:this.jointValue[0],this.jointValue[1]=o[1]!==null?o[1]:this.jointValue[1],this.jointValue[2]=o[2]!==null?o[2]:this.jointValue[2],xe.compose(this.origPosition,this.origQuaternion,ze),Je.setFromAxisAngle(this.axis,this.jointValue[2]),Be.set(this.jointValue[0],this.jointValue[1],0),Ge.compose(Be,Je,ze),xe.premultiply(Ge),this.position.setFromMatrixPosition(xe),this.rotation.setFromRotationMatrix(xe),this.matrixWorldNeedsUpdate=!0,!0)}return y}}class Ut extends Jt{constructor(...o){super(...o),this.type="URDFMimicJoint",this.mimicJoint=null,this.offset=0,this.multiplier=1}updateFromMimickedJoint(...o){const y=o.map(c=>c*this.multiplier+this.offset);return super.setJointValue(...y)}copy(o,y){return super.copy(o,y),this.mimicJoint=o.mimicJoint,this.offset=o.offset,this.multiplier=o.multiplier,this}}class Ti extends Gt{constructor(...o){super(...o),this.isURDFRobot=!0,this.urdfNode=null,this.urdfRobotNode=null,this.robotName=null,this.links=null,this.joints=null,this.colliders=null,this.visual=null,this.frames=null}copy(o,y){super.copy(o,y),this.urdfRobotNode=o.urdfRobotNode,this.robotName=o.robotName,this.links={},this.joints={},this.colliders={},this.visual={},this.traverse(c=>{c.isURDFJoint&&c.urdfName in o.joints&&(this.joints[c.urdfName]=c),c.isURDFLink&&c.urdfName in o.links&&(this.links[c.urdfName]=c),c.isURDFCollider&&c.urdfName in o.colliders&&(this.colliders[c.urdfName]=c),c.isURDFVisual&&c.urdfName in o.visual&&(this.visual[c.urdfName]=c)});for(const c in this.joints)this.joints[c].mimicJoints=this.joints[c].mimicJoints.map(j=>this.joints[j.name]);return this.frames={...this.colliders,...this.visual,...this.links,...this.joints},this}getFrame(o){return this.frames[o]}setJointValue(o,...y){const c=this.joints[o];return c?c.setJointValue(...y):!1}setJointValues(o){let y=!1;for(const c in o){const j=o[c];Array.isArray(j)?y=this.setJointValue(c,...j)||y:y=this.setJointValue(c,j)||y}return y}}const Qe=new it,St=new nt;function je(N){return N?N.trim().split(/\s+/g).map(o=>parseFloat(o)):[0,0,0]}function Dt(N,o,y=!1){y||N.rotation.set(0,0,0),St.set(o[0],o[1],o[2],"ZYX"),Qe.setFromEuler(St),Qe.multiply(N.quaternion),N.quaternion.copy(Qe)}class Li{constructor(o){this.manager=o||pi,this.loadMeshCb=this.defaultMeshLoader.bind(this),this.parseVisual=!0,this.parseCollision=!1,this.packages="",this.workingPath="",this.fetchOptions={}}loadAsync(o){return new Promise((y,c)=>{this.load(o,y,null,c)})}load(o,y,c,j){const R=this.manager,Z=Ot.extractUrlBase(o),S=this.manager.resolveURL(o);R.itemStart(S),fetch(S,this.fetchOptions).then(_=>{if(_.ok)return c&&c(null),_.text();throw new Error(`URDFLoader: Failed to load url '${S}' with error code ${_.status} : ${_.statusText}.`)}).then(_=>{const U=this.parse(_,this.workingPath||Z);y(U),R.itemEnd(S)}).catch(_=>{j?j(_):console.error("URDFLoader: Error loading file.",_),R.itemError(S),R.itemEnd(S)})}parse(o,y=this.workingPath){const c=this.packages,j=this.loadMeshCb,R=this.parseVisual,Z=this.parseCollision,S=this.manager,_={},U={},C={};function ie(O){if(!/^package:\/\//.test(O))return y?y+O:O;const[G,z]=O.replace(/^package:\/\//,"").split(/\/(.+)/);if(typeof c=="string")return c.endsWith(G)?c+"/"+z:c+"/"+G+"/"+z;if(c instanceof Function)return c(G)+"/"+z;if(typeof c=="object")return G in c?c[G]+"/"+z:(console.error(`URDFLoader : ${G} not found in provided package list.`),null)}function oe(O){let G;O instanceof Document?G=[...O.children]:O instanceof Element?G=[O]:G=[...new DOMParser().parseFromString(O,"text/xml").children];const z=G.filter(x=>x.nodeName==="robot").pop();return Q(z)}function Q(O){const G=[...O.children],z=G.filter(T=>T.nodeName.toLowerCase()==="link"),x=G.filter(T=>T.nodeName.toLowerCase()==="joint"),P=G.filter(T=>T.nodeName.toLowerCase()==="material"),D=new Ti;D.robotName=O.getAttribute("name"),D.urdfRobotNode=O,P.forEach(T=>{const w=T.getAttribute("name");C[w]=de(T)});const p={},f={};z.forEach(T=>{const w=T.getAttribute("name"),B=O.querySelector(`child[link="${w}"]`)===null;_[w]=H(T,p,f,B?D:null)}),x.forEach(T=>{const w=T.getAttribute("name");U[w]=se(T)}),D.joints=U,D.links=_,D.colliders=f,D.visual=p;const M=Object.values(U);return M.forEach(T=>{T instanceof Ut&&U[T.mimicJoint].mimicJoints.push(T)}),M.forEach(T=>{const w=new Set,B=ue=>{if(w.has(ue))throw new Error("URDFLoader: Detected an infinite loop of mimic joints.");w.add(ue),ue.mimicJoints.forEach(ae=>{B(ae)})};B(T)}),D.frames={...f,...p,..._,...U},D}function se(O){const G=[...O.children],z=O.getAttribute("type");let x;const P=G.find(w=>w.nodeName.toLowerCase()==="mimic");P?(x=new Ut,x.mimicJoint=P.getAttribute("joint"),x.multiplier=parseFloat(P.getAttribute("multiplier")||1),x.offset=parseFloat(P.getAttribute("offset")||0)):x=new Jt,x.urdfNode=O,x.name=O.getAttribute("name"),x.urdfName=x.name,x.jointType=z;let D=null,p=null,f=[0,0,0],M=[0,0,0];G.forEach(w=>{const B=w.nodeName.toLowerCase();B==="origin"?(f=je(w.getAttribute("xyz")),M=je(w.getAttribute("rpy"))):B==="child"?p=_[w.getAttribute("link")]:B==="parent"?D=_[w.getAttribute("link")]:B==="limit"&&(x.limit.lower=parseFloat(w.getAttribute("lower")||x.limit.lower),x.limit.upper=parseFloat(w.getAttribute("upper")||x.limit.upper))}),D.add(x),x.add(p),Dt(x,M),x.position.set(f[0],f[1],f[2]);const T=G.filter(w=>w.nodeName.toLowerCase()==="axis")[0];if(T){const w=T.getAttribute("xyz").split(/\s+/g).map(B=>parseFloat(B));x.axis=new he(w[0],w[1],w[2]),x.axis.normalize()}return x}function H(O,G,z,x=null){x===null&&(x=new Gt);const P=[...O.children];return x.name=O.getAttribute("name"),x.urdfName=x.name,x.urdfNode=O,R&&P.filter(p=>p.nodeName.toLowerCase()==="visual").forEach(p=>{const f=ge(p,C);if(x.add(f),p.hasAttribute("name")){const M=p.getAttribute("name");f.name=M,f.urdfName=M,G[M]=f}}),Z&&P.filter(p=>p.nodeName.toLowerCase()==="collision").forEach(p=>{const f=ge(p);if(x.add(f),p.hasAttribute("name")){const M=p.getAttribute("name");f.name=M,f.urdfName=M,z[M]=f}}),x}function de(O){const G=[...O.children],z=new Ve;return z.name=O.getAttribute("name")||"",G.forEach(x=>{const P=x.nodeName.toLowerCase();if(P==="color"){const D=x.getAttribute("rgba").split(/\s/g).map(p=>parseFloat(p));z.color.setRGB(D[0],D[1],D[2]),z.opacity=D[3],z.transparent=D[3]<1,z.depthWrite=!z.transparent}else if(P==="texture"){const D=x.getAttribute("filename");if(D){const p=new qt(S),f=ie(D);z.map=p.load(f),z.map.colorSpace=ke}}}),z}function ge(O,G={}){const z=O.nodeName.toLowerCase()==="collision",x=[...O.children];let P=null;const D=x.filter(f=>f.nodeName.toLowerCase()==="material")[0];if(D){const f=D.getAttribute("name");f&&f in G?P=G[f]:P=de(D)}else P=new Ve;const p=z?new Ai:new xi;return p.urdfNode=O,x.forEach(f=>{const M=f.nodeName.toLowerCase();if(M==="geometry"){const T=f.children[0].nodeName.toLowerCase();if(T==="mesh"){const w=f.children[0].getAttribute("filename"),B=ie(w);if(B!==null){const ue=f.children[0].getAttribute("scale");if(ue){const ae=je(ue);p.scale.set(ae[0],ae[1],ae[2])}j(B,S,(ae,d)=>{d?console.error("URDFLoader: Error loading mesh.",d):ae&&(ae instanceof Fe&&(ae.material=P),ae.position.set(0,0,0),ae.quaternion.identity(),p.add(ae))})}}else if(T==="box"){const w=new Fe;w.geometry=new mi(1,1,1),w.material=P;const B=je(f.children[0].getAttribute("size"));w.scale.set(B[0],B[1],B[2]),p.add(w)}else if(T==="sphere"){const w=new Fe;w.geometry=new gi(1,30,30),w.material=P;const B=parseFloat(f.children[0].getAttribute("radius"))||0;w.scale.set(B,B,B),p.add(w)}else if(T==="cylinder"){const w=new Fe;w.geometry=new bi(1,1,1,30),w.material=P;const B=parseFloat(f.children[0].getAttribute("radius"))||0,ue=parseFloat(f.children[0].getAttribute("length"))||0;w.scale.set(B,ue,B),w.rotation.set(Math.PI/2,0,0),p.add(w)}}else if(M==="origin"){const T=je(f.getAttribute("xyz")),w=je(f.getAttribute("rpy"));p.position.set(T[0],T[1],T[2]),p.rotation.set(0,0,0),Dt(p,w)}}),p}return oe(o)}defaultMeshLoader(o,y,c){/\.stl$/i.test(o)?new wi(y).load(o,R=>{const Z=new Fe(R,new Ve);c(Z)}):/\.dae$/i.test(o)?new ki(y).load(o,R=>c(R.scene)):console.warn(`URDFLoader: Could not load model at ${o}.
No loader available`)}}export{ki as C,wi as S,Li as U,_i as a,Ci as s,yi as u};
